<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>以甯为意</title>
  
  
  <link href="http://junonin.github.io/atom.xml" rel="self"/>
  
  <link href="http://junonin.github.io/"/>
  <updated>2020-12-19T06:31:05.524Z</updated>
  <id>http://junonin.github.io/</id>
  
  <author>
    <name>Juno Nin</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Sql随机查询数据语句(NewID(),Rnd,Rand(),Random())</title>
    <link href="http://junonin.github.io/posts/a4322757.html"/>
    <id>http://junonin.github.io/posts/a4322757.html</id>
    <published>2020-12-18T03:43:57.000Z</published>
    <updated>2020-12-19T06:31:05.524Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote><p>想从数据库随机抽取数据，想到使用Rand()函数，记录下。<br>参考：<a href="https://www.cnblogs.com/alibai/p/4104564.html">SQL随机查询数据语句</a></p></blockquote><h2 id="SQL-Server"><a href="#SQL-Server" class="headerlink" title="SQL Server"></a>SQL Server</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> TOP N * <span class="keyword">From</span> <span class="keyword">TABLE</span> <span class="keyword">Order</span> <span class="keyword">By</span> NewID()</span><br><span class="line"></span><br><span class="line">NewID()函数将创建一个 uniqueidentifier 类型的唯一值。上面的语句实现效果是从<span class="keyword">Table</span>中随机读取N条记录。</span><br><span class="line">Uniqueidentifier用来存储一个全局唯一标识符，即GUID。</span><br></pre></td></tr></table></figure><h2 id="Access"><a href="#Access" class="headerlink" title="Access"></a>Access</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> TOP N * <span class="keyword">From</span> <span class="keyword">TABLE</span> <span class="keyword">Order</span> <span class="keyword">By</span> Rnd(<span class="keyword">ID</span>)</span><br><span class="line"></span><br><span class="line">Rnd(<span class="keyword">ID</span>) 其中的<span class="keyword">ID</span>是自动编号字段，可以利用其他任何数值来完成，比如用姓名字段(UserName)</span><br><span class="line"></span><br><span class="line"><span class="keyword">Select</span> TOP N * <span class="keyword">From</span> <span class="keyword">TABLE</span> <span class="keyword">Order</span> <span class="keyword">BY</span> Rnd(<span class="keyword">Len</span>(UserName))</span><br></pre></td></tr></table></figure><h2 id="MySql"><a href="#MySql" class="headerlink" title="MySql"></a>MySql</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> * <span class="keyword">From</span> <span class="keyword">TABLE</span> <span class="keyword">Order</span> <span class="keyword">By</span> <span class="keyword">Rand</span>() <span class="keyword">Limit</span> <span class="number">10</span></span><br></pre></td></tr></table></figure><ul><li>在查询分析器中执行：select rand()，可以看到结果会是类似于这样的随机小数：0.36361513486289558，像这样的小数在实际应用中用得不多，一般要取随机数都会取随机整数。那就看下面的两种随机取整数的方法：<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">A：<span class="keyword">select</span>  <span class="keyword">floor</span>(<span class="keyword">rand</span>()*N)  <span class="comment">---生成的数是这样的：12.0</span></span><br><span class="line">B：<span class="keyword">select</span> <span class="keyword">cast</span>( <span class="keyword">floor</span>(<span class="keyword">rand</span>()*N) <span class="keyword">as</span> <span class="built_in">int</span>)  <span class="comment">---生成的数是这样的：12</span></span><br><span class="line"></span><br><span class="line">A：<span class="keyword">select</span> <span class="keyword">ceiling</span>(<span class="keyword">rand</span>() * N)  <span class="comment">---生成的数是这样的：12.0</span></span><br><span class="line">B：<span class="keyword">select</span> <span class="keyword">cast</span>(<span class="keyword">ceiling</span>(<span class="keyword">rand</span>() * N) <span class="keyword">as</span> <span class="built_in">int</span>)  <span class="comment">---生成的数是这样的：12</span></span><br></pre></td></tr></table></figure></li><li>比较 CEILING 和 FLOOR<br>CEILING 函数返回大于或等于所给数字表达式的最小整数。FLOOR 函数返回小于或等于所给数字表达式的最大整数。例如，对于数字表达式 12.9273，CEILING 将返回 13，FLOOR 将返回 12。FLOOR 和 CEILING 返回值的数据类型都与输入的数字表达式的数据类型相同。</li></ul><h2 id="PostgreSQL"><a href="#PostgreSQL" class="headerlink" title="PostgreSQL"></a>PostgreSQL</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> glxt022 <span class="keyword">order</span> <span class="keyword">by</span> random() <span class="keyword">limit</span> <span class="number">5</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Sql随机查询数据语句</summary>
    
    
    
    <category term="SQL" scheme="http://junonin.github.io/categories/SQL/"/>
    
    
    <category term="SQL" scheme="http://junonin.github.io/tags/SQL/"/>
    
  </entry>
  
  <entry>
    <title>windows server 服务器配置多用户登录</title>
    <link href="http://junonin.github.io/posts/f6bc6e38.html"/>
    <id>http://junonin.github.io/posts/f6bc6e38.html</id>
    <published>2020-12-07T08:06:14.000Z</published>
    <updated>2020-12-07T08:30:44.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote><p>因为防止多个用户同时需要访问服务器导致服务器导致另一个用户正在使用的服务器被挤掉退出<br>参考：<a href="https://www.mysysadmintips.com/windows/clients/545-multiple-rdp-remote-desktop-sessions-in-windows-10">Windows 10中的多个RDP（远程桌面）会话</a><br>参考：<a href="https://blog.csdn.net/zl570932980/article/details/77671597">windows server 2012 r2服务器配置多用户登录</a><br>参考：<a href="https://lighti.me/2858.html">Windows Server 2012 实现多个用户同时远程桌面登陆</a><br>参考：<a href="https://github.com/stascorp/rdpwrap">RDP Wrapper Library by Stas’M (Github)</a></p></blockquote><h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><blockquote><p>因为Windows系统可以通过修改本地组策略来改变RDP的登录属性来使多用户同时远程服务器</p></blockquote><ul><li><p>1.在 <strong>【运行】</strong> 输入 <strong>gpedit.msc</strong> 然后进行回车进入本地组策略<br><img src= "/img/loading.gif" data-lazy-src="https://s3.ax1x.com/2020/12/07/DxQOqs.png" alt="DxQOqs.png"><br><img src= "/img/loading.gif" data-lazy-src="https://s3.ax1x.com/2020/12/07/DxlflF.png" alt="DxlflF.png"></p></li><li><p>2.在左侧栏选择 <strong>【计算机配置】</strong> -&gt; <strong>【管理模板】</strong> -&gt; <strong>【Windows组件】</strong> 然后再右栏里选择 <strong>【运程桌面服务】</strong><br><img src= "/img/loading.gif" data-lazy-src="https://s3.ax1x.com/2020/12/07/Dx1VXQ.png" alt="Dx1VXQ.png"></p></li><li><p>3.选择 <strong>【远程桌面会话主机】</strong> 点击打开<br><img src= "/img/loading.gif" data-lazy-src="https://s3.ax1x.com/2020/12/07/Dx3Pb9.png" alt="Dx3Pb9.png"></p></li><li><p>4.选择 <strong>【连接】</strong> 点击打开<br><img src= "/img/loading.gif" data-lazy-src="https://s3.ax1x.com/2020/12/07/Dx3GPP.png" alt="Dx3GPP.png"></p></li><li><p>5.选择 <strong>【将远程桌面服务用户限制到单独的远程桌面服务会话】</strong> 点击打开，修改为 <strong>【已禁用】</strong> 操作完后选择 <strong>【应用】</strong> 最后 <strong>【确定】</strong><br><img src= "/img/loading.gif" data-lazy-src="https://s3.ax1x.com/2020/12/07/Dx34aR.png" alt="Dx34aR.png"></p></li><li><p>6.我这里修改的最大连接数是3，根据自己的需要修改连接数吧！<br>选择 <strong>【连接】</strong> 点击打开再选择 <strong>【限制连接的数量】</strong> 点击打开默认是已禁用的，选择 <strong>【已启用】</strong> ，然后选择 <strong>【应用】</strong> 最后 <strong>【确定】</strong><br><img src= "/img/loading.gif" data-lazy-src="https://s3.ax1x.com/2020/12/07/Dx8pJP.png" alt="Dx8pJP.png"></p></li></ul><p>这样就可以同时登录多用户登录了，如下：<br><img src= "/img/loading.gif" data-lazy-src="https://s3.ax1x.com/2020/12/07/Dx8swd.png" alt="Dx8swd.png"></p>]]></content>
    
    
    <summary type="html">windows server 服务器配置多用户登录</summary>
    
    
    
    <category term="Windows Server" scheme="http://junonin.github.io/categories/Windows-Server/"/>
    
    
    <category term="Windows Server" scheme="http://junonin.github.io/tags/Windows-Server/"/>
    
  </entry>
  
  <entry>
    <title>MySQL索引原则</title>
    <link href="http://junonin.github.io/posts/ca3480e9.html"/>
    <id>http://junonin.github.io/posts/ca3480e9.html</id>
    <published>2020-12-05T08:21:12.000Z</published>
    <updated>2020-12-05T09:22:38.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote><p>有关索引的知识，记录下，防止遗忘</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名 <span class="keyword">ADD</span> [<span class="keyword">UNIQUE</span> | FULLTEXT | SPATIAL]  <span class="keyword">INDEX</span> | <span class="keyword">KEY</span>  [索引名] (字段名<span class="number">1</span> [(长度)] [<span class="keyword">ASC</span> | <span class="keyword">DESC</span>]) [<span class="keyword">USING</span> 索引方法]；</span><br><span class="line">或</span><br><span class="line"><span class="keyword">CREATE</span>  [<span class="keyword">UNIQUE</span> | FULLTEXT | SPATIAL]  <span class="keyword">INDEX</span>  索引名 <span class="keyword">ON</span>  表名(字段名) [<span class="keyword">USING</span> 索引方法]；</span><br></pre></td></tr></table></figure><h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><h3 id="最左前缀匹配原则"><a href="#最左前缀匹配原则" class="headerlink" title="最左前缀匹配原则"></a>最左前缀匹配原则</h3><p>MySQL 会一直向右匹配直到遇到范围查询(&gt;、&lt;、between、like)就停止匹配。所以要尽量把这些条件放在最后，把“=”条件放在前面。举例如下：</p><pre><code>反例，不会用到 b 列的索引：<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> xttblog <span class="keyword">where</span> a=<span class="number">1</span> <span class="keyword">and</span> c&gt;<span class="number">0</span> <span class="keyword">and</span> b=<span class="number">2</span></span><br></pre></td></tr></table></figure>正例，会用到 b 列的索引：<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> xttblog <span class="keyword">where</span> a=<span class="number">1</span> <span class="keyword">and</span> b=<span class="number">2</span> <span class="keyword">and</span> c&gt;<span class="number">0</span></span><br></pre></td></tr></table></figure></code></pre><p>在索引选择上，尽量选择区分度高的列作为索引，区分度的公式是 count(distinct col)/count(*)，表示字段不重复的比例，比例越大我们扫描的记录数越少。</p><div class="note red icon simple"><i class="note-icon fas fa-fan"></i><p>默认情况下，当取出的数据超过全表数据的 20% 时，不会使用索引。</p></div><h3 id="like-使用原则"><a href="#like-使用原则" class="headerlink" title="like 使用原则"></a>like 使用原则</h3><pre><code>反例，不使用索引：<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> codedq <span class="keyword">where</span> <span class="keyword">name</span> <span class="keyword">like</span> <span class="string">&#x27;%JUNO%&#x27;</span></span><br></pre></td></tr></table></figure>正例，使用索引：<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> codedq <span class="keyword">where</span> <span class="keyword">name</span> <span class="keyword">like</span> <span class="string">&#x27;JUNO%&#x27;</span></span><br></pre></td></tr></table></figure></code></pre><h3 id="or-和-union-all"><a href="#or-和-union-all" class="headerlink" title="or 和 union all"></a>or 和 union all</h3><p>or 和 union all 的使用选择。推荐尽量将 or 转换为 union all。</p><pre><code>反例，不使用索引：<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> xttblog <span class="keyword">where</span> <span class="keyword">name</span>=<span class="string">&#x27;JUNO&#x27;</span> <span class="keyword">or</span> age=<span class="string">&#x27;20&#x27;</span></span><br></pre></td></tr></table></figure>正例，使用索引：<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> xttblog <span class="keyword">where</span> <span class="keyword">name</span> =<span class="string">&#x27;JUNO&#x27;</span> </span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span> </span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> xttblog <span class="keyword">where</span> age =<span class="string">&#x27;20&#x27;</span></span><br></pre></td></tr></table></figure></code></pre><h3 id="索引-函数"><a href="#索引-函数" class="headerlink" title="索引+函数"></a>索引+函数</h3><p>字段加上大多数函数都不会使用索引。所以尽量把函数放在数值上。</p><pre><code>反例，不使用索引：<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> xttblog <span class="keyword">where</span> <span class="keyword">truncate</span>(price) = <span class="number">888</span></span><br></pre></td></tr></table></figure>正例，使用索引：<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> xttblog <span class="keyword">where</span> price &gt; <span class="number">887</span> <span class="keyword">and</span> price &lt; <span class="number">889</span></span><br></pre></td></tr></table></figure></code></pre><h3 id="索引列数据类型转换"><a href="#索引列数据类型转换" class="headerlink" title="索引列数据类型转换"></a>索引列数据类型转换</h3><p>如果索引列使用的类型不对，发生类型转换。那么就需要注意，很可能不会按照你的期望走索引。</p><pre><code>反例，不使用索引：<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> xttblog <span class="keyword">where</span> mobile = <span class="number">1314520</span></span><br></pre></td></tr></table></figure>正例，使用索引：<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> xttblog <span class="keyword">where</span> mobile = <span class="string">&#x27;1314520&#x27;</span></span><br></pre></td></tr></table></figure></code></pre><h3 id="列上计算"><a href="#列上计算" class="headerlink" title="列上计算"></a>列上计算</h3><p>字段加运算符不会使用索引。所以尽量把运算放在数值上。</p><pre><code>反例，不使用索引：<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">account</span>, amount</span><br><span class="line"><span class="keyword">FROM</span> codedq</span><br><span class="line"><span class="keyword">WHERE</span> amount + <span class="number">3000</span> &gt; <span class="number">5000</span>;</span><br></pre></td></tr></table></figure>正例，使用索引：<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">account</span>, amount</span><br><span class="line"><span class="keyword">FROM</span> codedq</span><br><span class="line"><span class="keyword">WHERE</span> amount &gt; <span class="number">2000</span> ;</span><br></pre></td></tr></table></figure></code></pre><h3 id="组合索引"><a href="#组合索引" class="headerlink" title="组合索引"></a>组合索引</h3><p>使用组合索引时，必须要包括第一个列。</p><pre><code>例如<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> xttblog <span class="keyword">add</span> <span class="keyword">index</span>(a,b,c)：</span><br></pre></td></tr></table></figure>反例，不使用索引：<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> xttblog <span class="keyword">where</span> b=<span class="number">1</span> <span class="keyword">and</span> c=<span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> xttblog <span class="keyword">where</span> b=<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> xttblog <span class="keyword">where</span> c=<span class="number">2</span>;</span><br></pre></td></tr></table></figure>正例，使用索引： <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> xttblog <span class="keyword">where</span> a=<span class="number">1</span> <span class="keyword">AND</span> b=<span class="number">1</span> <span class="keyword">AND</span> c=<span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> xttblog <span class="keyword">where</span> a=<span class="number">1</span> <span class="keyword">AND</span> b=<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> xttblog <span class="keyword">where</span> a=<span class="number">1</span> <span class="keyword">AND</span> c=<span class="number">2</span>;</span><br></pre></td></tr></table></figure></code></pre><h3 id="is-null或is-not-null"><a href="#is-null或is-not-null" class="headerlink" title="is null或is not null"></a>is null或is not null</h3><p>尽量避免使用 is null 或 is not null。</p><pre><code>反例，不使用索引：<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> …</span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> codedq</span><br><span class="line"></span><br><span class="line"><span class="keyword">WHERE</span> age <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>;</span><br></pre></td></tr></table></figure>正例，使用索引： <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> …</span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> codedq</span><br><span class="line"></span><br><span class="line"><span class="keyword">WHERE</span> age &gt;<span class="number">0</span>;</span><br></pre></td></tr></table></figure></code></pre><h3 id="不等于（-）"><a href="#不等于（-）" class="headerlink" title="不等于（!=）"></a>不等于（!=）</h3><p>不等于（!=）不会使用索引。</p><pre><code>反例，不使用索引：<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">name</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> xttblog</span><br><span class="line"></span><br><span class="line"><span class="keyword">WHERE</span> age !=<span class="number">0</span>;</span><br></pre></td></tr></table></figure>正例，使用索引： <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">name</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> xttblog</span><br><span class="line"></span><br><span class="line"><span class="keyword">WHERE</span> age &gt;<span class="number">0</span>;</span><br></pre></td></tr></table></figure></code></pre><h3 id="ORDER-BY-子句"><a href="#ORDER-BY-子句" class="headerlink" title="ORDER BY 子句"></a>ORDER BY 子句</h3><p>ORDER BY 子句只在以下的条件下使用索引：</p><ol><li><p>ORDER BY 中所有的列必须包含在相同的索引中并保持在索引中的排列顺序</p></li><li><p>ORDER BY 中不能既有 ASC 也有 DESC</p><pre><code> 举例： <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> xttblog <span class="keyword">add</span> <span class="keyword">index</span>(a,b);</span><br><span class="line"></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> xttblog <span class="keyword">add</span> <span class="keyword">index</span>(c);</span><br></pre></td></tr></table></figure> 反例，不使用索引： <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 不在一个索引中</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> xttblog <span class="keyword">order</span> <span class="keyword">by</span> a,c; </span><br><span class="line"><span class="comment">## 没有出现组合索引的第一列</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> xttblog <span class="keyword">order</span> <span class="keyword">by</span> b; </span><br><span class="line"><span class="comment">## 混合 ASC 和 DESC</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> xttblog <span class="keyword">order</span> <span class="keyword">by</span> a <span class="keyword">asc</span>, b <span class="keyword">desc</span>; </span><br><span class="line"><span class="comment">## where和order by用的不是同一个索引，where使用索引，order by不使用。</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> xttblog <span class="keyword">where</span> a=<span class="number">1</span> <span class="keyword">order</span> <span class="keyword">by</span> c; </span><br></pre></td></tr></table></figure> 正例，使用索引：  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> xttblog <span class="keyword">order</span> <span class="keyword">by</span> a,b;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> xttblog <span class="keyword">order</span> <span class="keyword">where</span> a=<span class="number">1</span> <span class="keyword">order</span> <span class="keyword">by</span> b;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> xttblog <span class="keyword">order</span> <span class="keyword">where</span> a=<span class="number">1</span> <span class="keyword">order</span> <span class="keyword">by</span> a,b;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> xttblog <span class="keyword">order</span> <span class="keyword">by</span> a <span class="keyword">desc</span>, b <span class="keyword">desc</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> xttblog <span class="keyword">where</span> c=<span class="number">1</span> <span class="keyword">order</span> <span class="keyword">by</span> c;</span><br></pre></td></tr></table></figure></code></pre></li></ol>]]></content>
    
    
    <summary type="html">MySQL索引原则</summary>
    
    
    
    <category term="SQL" scheme="http://junonin.github.io/categories/SQL/"/>
    
    
    <category term="SQL" scheme="http://junonin.github.io/tags/SQL/"/>
    
  </entry>
  
  <entry>
    <title>RAID模式</title>
    <link href="http://junonin.github.io/posts/578763b3.html"/>
    <id>http://junonin.github.io/posts/578763b3.html</id>
    <published>2020-12-04T03:06:46.000Z</published>
    <updated>2020-12-04T03:49:12.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote><p>因为安装了黑群晖，需要做一个raid来保证数据的安全和完整，便了解了下raid的原理。<br>参考：<a href="https://www.jianshu.com/p/71e94907b9da">基本RAID级别简介</a></p></blockquote><h2 id="RAID"><a href="#RAID" class="headerlink" title="RAID"></a>RAID</h2><h3 id="RAID-0：无差错控制的带区组"><a href="#RAID-0：无差错控制的带区组" class="headerlink" title="RAID 0：无差错控制的带区组"></a>RAID 0：无差错控制的带区组</h3><p><img src= "/img/loading.gif" data-lazy-src="https://s3.ax1x.com/2020/12/04/DHWb6I.jpg" alt="DHWb6I.jpg"></p><p>要实现RAID 0必须要有两个以上硬盘驱动器，RAID 0实现了带区组，数据并不是保存在一个硬盘上，而是分成数据块保存在不同驱动器上。因为将数据分布在不）编辑和其它要求传输比较大的场合使用RAID0比较合适。同时，RAID可以提高数据传输速率，比如同驱动器上，所以数据吞吐率大大提高，驱动器的负载也比较平衡。如果刚好所需要的数据在不同的驱动器上效率最好。它不需要计算校验码，实现容易。它的缺点是它没有数据差错控制，如果一个驱动器中的数据发生错误，即使其它盘上的数据正确也无济于事了。不应该将它用于对数据稳定性要求高的场合。如果用户进行图象（包括动画所需读取的文件分布在两个硬盘上，这两个硬盘可以同时读取。那么原来读取同样文件的时间被缩短为1/2。在所有的级别中，RAID 0的速度是最快的。但是RAID 0没有冗余功能的，如果一个磁盘（物理）损坏，则所有的数据都无法使用。</p><h3 id="RAID-1：镜像结构"><a href="#RAID-1：镜像结构" class="headerlink" title="RAID 1：镜像结构"></a>RAID 1：镜像结构</h3><p><img src= "/img/loading.gif" data-lazy-src="https://s3.ax1x.com/2020/12/04/DHWj78.jpg" alt="DHWj78.jpg"></p><p>对于使用这种RAID 1结构的设备来说，RAID控制器必须能够同时对两个盘进行读操作和对两个镜象盘进行写操作。因为是镜象结构在一组盘出现问题时，可以使用镜象，提高系统的容错能力。它比较容易设计和实现。每读一次盘只能读出一块数据，也就是说数据块传送速率与单独的盘的读取速率相同。因为RAID 1的校验十分完备，因此对系统的处理能力有很大的影响，通常的RAID功能由软件实现，而这样的实现方法在服务器负载比较重的时候会大大影响服务器效率。当您的系统需要极高的可靠性时，如进行数据统计，那么使用RAID 1比较合适。而且RAID 1技术支持“热替换”，即不断电的情况下对故障磁盘进行更换，更换完毕只要从镜像盘上恢复数据即可。当主硬盘损坏时，镜像硬盘就可以代替主硬盘工作。镜像硬盘相当于一个备份盘，可想而知，这种硬盘模式的安全性是非常高的，RAID 1的数据安全性在所有的RAID级别上来说是最好的。但是其磁盘的利用率却只有50%，是所有RAID级别中最低的。</p><h3 id="RAID-1-5：一个新生的磁盘阵列方式"><a href="#RAID-1-5：一个新生的磁盘阵列方式" class="headerlink" title="RAID 1.5：一个新生的磁盘阵列方式"></a>RAID 1.5：一个新生的磁盘阵列方式</h3><p>它具有RAID 0+1的特性，而不同的是，它的实现只需要2个硬盘。从表面上来看，组建RAID 1.5后的磁盘，两个都具有相同的数据。当然，RAID 1.5也是一种不能完全利用磁盘空间的磁盘阵列模式，因此，两个80GB的硬盘在组建RAID 1.5后，和RAID 1是一样的，即只有80GB的实际使用空间，另外80GB是它的备份数据。如果把两个硬盘分开，分别把他们运行在原系统，也是畅通无阻的。但通过实际应用，我们发现如果两个硬盘在分开运行后，其数据的轻微改变都会引起再次重组后的磁盘阵列，没法实现完全的数据恢复，而是以数据较少的磁盘为准。</p><h3 id="RAID-2：带海明码校验"><a href="#RAID-2：带海明码校验" class="headerlink" title="RAID 2：带海明码校验"></a>RAID 2：带海明码校验</h3><p><img src= "/img/loading.gif" data-lazy-src="https://s3.ax1x.com/2020/12/04/DHfE7T.jpg" alt="DHfE7T.jpg"></p><p>这是RAID 0的改良版，以汉明码（Hamming Code）的方式将数据进行编码后分区为独立的比特，并将数据分别写入硬盘中。因为在数据中加入了错误修正码（ECC，Error Correction Code），所以数据整体的容量会比原始数据大一些，RAID 2最少要三台磁盘驱动器方能运作。从概念上讲，RAID 2同RAID 3类似， 两者都是将数据条块化分布于不同的硬盘上， 条块单位为位或字节。然而RAID 2 使用一定的编码技术来提供错误检查及恢复。这种编码技术需要多个磁盘存放检查及恢复信息，使得RAID 2技术实施更复杂。因此，在商业环境中很少使用。下图右边的各个磁盘上是数据的各个位，由一个数据不同的位运算得到的海明校验码可以保存另一组磁盘上，具体情况请见下图。由于海明码的特点，它可以在数据发生错误的情况下将错误校正，以保证输出的正确。它的数据传送速率相当高，如果希望达到比较理想的速度，那最好提高保存校验码ECC码的硬盘，对于控制器的设计来说，它又比RAID 3、4或5要简单。没有免费的午餐，这里也一样，要利用海明码，必须要付出数据冗余的代价。输出数据的速率与驱动器组中速度最慢的相等。</p><h3 id="RAID-3：带奇偶校验码的并行传送"><a href="#RAID-3：带奇偶校验码的并行传送" class="headerlink" title="RAID 3：带奇偶校验码的并行传送"></a>RAID 3：带奇偶校验码的并行传送</h3><p><img src= "/img/loading.gif" data-lazy-src="https://s3.ax1x.com/2020/12/04/DHfmh4.jpg" alt="DHfmh4.jpg"></p><p>用Bit-interleaving（数据交错存储）技术，它需要通过编码再将数据比特分割后分别存在硬盘中，而将同比特检查后单独存在一个硬盘中，但由于数据内的比特分散在不同的硬盘上，因此就算要读取一小段数据资料都可能需要所有的硬盘进行工作，所以这种规格比较适于读取大量数据时使用。这种校验码与RAID 2不同，只能查错不能纠错。它访问数据时一次处理一个带区，这样可以提高读取和写入速度,它像RAID 0一样以并行的方式来存放数据，但速度没有RAID 0快。校验码在写入数据时产生并保存在另一个磁盘上。需要实现时用户必须要有三个以上的驱动器，写入速率与读出速率都很高，因为校验位比较少，因此计算时间相对而言比较少。用软件实现RAID控制将是十分困难的，控制器的实现也不是很容易。它主要用于图形（包括动画）等要求吞吐率比较高的场合。不同于RAID 2，RAID 3使用单块磁盘存放奇偶校验信息。如果一块磁盘失效，奇偶盘及其他数据盘可以重新产生数据。 如果奇偶盘失效，则不影响数据使用。RAID 3对于大量的连续数据可提供很好的传输率，但对于随机数据，奇偶盘会成为写操作的瓶颈。 利用单独的校验盘来保护数据虽然没有镜像的安全性高，但是硬盘利用率得到了很大的提高，为（n-1）/n。</p><h3 id="RAID-4：带奇偶校验码的独立磁盘结构"><a href="#RAID-4：带奇偶校验码的独立磁盘结构" class="headerlink" title="RAID 4：带奇偶校验码的独立磁盘结构"></a>RAID 4：带奇偶校验码的独立磁盘结构</h3><p><img src= "/img/loading.gif" data-lazy-src="https://s3.ax1x.com/2020/12/04/DHf1nx.jpg" alt="DHf1nx.jpg"></p><p>RAID 4和RAID 3很像，不同的是它在分区时是以区块为单位分别存在硬盘中，但每次的数据访问都必须从同比特检查的那个硬盘中取出对应的同比特数据进行核对，也就是按磁盘进行的，每次是一个盘。由于过于频繁的使用，所以对硬盘的损耗可能会提高。（块交织技术，Block interleaving）在图上可以这么看，RAID 3是一次一横条，而RAID 4一次一竖条。它的特点的RAID 3也挺象，不过在失败恢复时，它的难度可要比RAID 3大得多了，控制器的设计难度也要大许多，而且访问数据的效率不怎么好。</p><h3 id="RAID-5：分布式奇偶校验的独立磁盘结构"><a href="#RAID-5：分布式奇偶校验的独立磁盘结构" class="headerlink" title="RAID 5：分布式奇偶校验的独立磁盘结构"></a>RAID 5：分布式奇偶校验的独立磁盘结构</h3><p><img src= "/img/loading.gif" data-lazy-src="https://s3.ax1x.com/2020/12/04/DHfwjI.jpg" alt="DHfwjI.jpg"></p><p>RAID Level 5是一种储存性能、数据安全和存储成本兼顾的存储解决方案。它使用的是Disk Striping（硬盘分割）技术。RAID 5至少需要三个硬盘，RAID 5不是对存储的数据进行备份，而是把数据和相对应的奇偶校验信息存储到组成RAID5的各个磁盘上，并且奇偶校验信息和相对应的数据分别存储于不同的磁盘上。当RAID5的一个磁盘数据发生损坏后，可以利用剩下的数据和相应的奇偶校验信息去恢复被损坏的数据。RAID 5可以理解为是RAID 0和RAID 1的折衷方案。RAID 5可以为系统提供数据安全保障，但保障程度要比镜像低而磁盘空间利用率要比镜像高。RAID 5具有和RAID 0相近似的数据读取速度，只是因为多了一个奇偶校验信息，写入数据的速度相对单独写入一块硬盘的速度略慢，若使用“回写缓存”可以让性能改善不少。同时由于多个数据对应一个奇偶校验信息，RAID 5的磁盘空间利用率要比RAID 1高，存储成本相对较便宜。</p><h3 id="RAID-6：-两种存储的奇偶校验码的磁盘结构"><a href="#RAID-6：-两种存储的奇偶校验码的磁盘结构" class="headerlink" title="RAID 6： 两种存储的奇偶校验码的磁盘结构"></a>RAID 6： 两种存储的奇偶校验码的磁盘结构</h3><p><img src= "/img/loading.gif" data-lazy-src="https://s3.ax1x.com/2020/12/04/DHf2CQ.jpg" alt="DHf2CQ.jpg"></p><p>与RAID 5相比，RAID 6增加第二个独立的奇偶校验信息块。两个独立的奇偶系统使用不同的算法，数据的可靠性非常高，任意两块磁盘同时失效时不会影响数据完整性。RAID 6需要分配给奇偶校验信息更大的磁盘空间和额外的校验计算，相对于RAID 5有更大的IO操作量和计算量，其“写性能”强烈取决于具体的实现方案，因此RAID 6通常不会通过软件方式来实现，而更可能通过硬件方式实现。同一数组中最多容许两个磁盘损坏。更换新磁盘后，数据将会重新算出并写入新的磁盘中。</p><h3 id="RAID-7：优化的高速数据传送磁盘结构"><a href="#RAID-7：优化的高速数据传送磁盘结构" class="headerlink" title="RAID 7：优化的高速数据传送磁盘结构"></a>RAID 7：优化的高速数据传送磁盘结构</h3><p><img src= "/img/loading.gif" data-lazy-src="https://s3.ax1x.com/2020/12/04/DHfzb6.png" alt="DHfzb6.png"></p><p>RAID 7并非公开的RAID标准，而是Storage Computer Corporation的专利硬件产品名称，RAID 7是以RAID 3及RAID 4为基础所发展，但是经过强化以解决原来的一些限制。另外，在实现中使用大量的缓冲存储器以及用以实现异步数组管理的专用即时处理器，使得RAID 7可以同时处理大量的IO要求，所以性能甚至超越了许多其他RAID标准的实做产品。但也因为如此，在价格方面非常的高昂。</p><h3 id="RAID-10-01：高可靠性与高效磁盘结构"><a href="#RAID-10-01：高可靠性与高效磁盘结构" class="headerlink" title="RAID 10/01：高可靠性与高效磁盘结构"></a>RAID 10/01：高可靠性与高效磁盘结构</h3><p><img src= "/img/loading.gif" data-lazy-src="https://s3.ax1x.com/2020/12/04/DHfO29.png" alt="DHfO29.png"></p><p>RAID 10是先分割数据再镜像，再将所有硬盘分为两组，视为以RAID 1作为最低组合，然后将每组RAID 1视为一个“硬盘”组合为RAID 0运作。</p>![DHhZrt.png](https://s3.ax1x.com/2020/12/04/DHhZrt.png)<p>RAID 01则是跟RAID 10的程序相反，是先镜像再将数据到分割两组硬盘。它将所有的硬盘分为两组，每组各自构成为RAID 0作为最低组合，而将两组硬盘组合为RAID 1运作。<p>当RAID 10有一个硬盘受损，其余硬盘会继续运作。RAID 01只要有一个硬盘受损，同组RAID 0的所有硬盘都会停止运作，只剩下其他组的硬盘运作，可靠性较低。如果以六个硬盘建RAID 01，镜像再用三个建RAID 0，那么坏一个硬盘便会有三个硬盘离线。因此，RAID 10远较RAID 01常用，零售主板绝大部分支持RAID 0/1/5/10，但不支持RAID 01。</p></p><h3 id="RAID-50：被称为分布奇偶位阵列条带"><a href="#RAID-50：被称为分布奇偶位阵列条带" class="headerlink" title="RAID 50：被称为分布奇偶位阵列条带"></a>RAID 50：被称为分布奇偶位阵列条带</h3><p><img src= "/img/loading.gif" data-lazy-src="https://s3.ax1x.com/2020/12/04/DHhqdf.png" alt="DHhqdf.png"></p><p>RAID 5与RAID 0的组合，先作RAID 5，再作RAID 0，也就是对多组RAID 5彼此构成Stripe访问。由于RAID 50是以RAID 5为基础，而RAID 5至少需要3颗硬盘，因此要以多组RAID 5构成RAID 50，至少需要6颗硬盘。以RAID 50最小的6颗硬盘配置为例，先把6颗硬盘分为2组，每组3颗构成RAID 5，如此就得到两组RAID 5，然后再把两组RAID 5构成RAID 0。<p>RAID 50在底层的任一组或多组RAID 5中出现1颗硬盘损坏时，仍能维持运作，不过如果任一组RAID 5中出现2颗或2颗以上硬盘损毁，整组RAID 50就会失效。</p><p>RAID 50由于在上层把多组RAID 5构成Stripe，性能比起单纯的RAID 5高，容量利用率比RAID5要低。比如同样使用9颗硬盘，由各3颗RAID 5再组成RAID 0的RAID 50，每组RAID 5浪费一颗硬盘，利用率为(1-3/9)，RAID 5则为(1-1/9)。</p></p><h3 id="RAID-53：称为高效数据传送磁盘结构"><a href="#RAID-53：称为高效数据传送磁盘结构" class="headerlink" title="RAID 53：称为高效数据传送磁盘结构"></a>RAID 53：称为高效数据传送磁盘结构</h3><p><img src= "/img/loading.gif" data-lazy-src="https://s3.ax1x.com/2020/12/04/DH4eSJ.png" alt="DH4eSJ.png"></p><p>它拥有一个镜射条带数组，硬盘里其中一个条带就是一个是由3组以上的RAID 5组成RAID 3硬盘阵列。</p><h3 id="RAID-60"><a href="#RAID-60" class="headerlink" title="RAID 60"></a>RAID 60</h3><p><img src= "/img/loading.gif" data-lazy-src="https://s3.ax1x.com/2020/12/04/DH4lTK.png" alt="DH4lTK.png"></p><p>RAID 6与RAID 0的组合：先作RAID 6，再作RAID 0。换句话说，就是对两组以上的RAID 6作Stripe访问。RAID 6至少需具备4颗硬盘，所以RAID 60的最小需求是8颗硬盘。<p>由于底层是以RAID 6组成，所以RAID 60可以容许任一组RAID 6中损毁最多2颗硬盘，而系统仍能维持运作；不过只要底层任一组RAID 6中损毁3颗硬盘，整组RAID 60就会失效，当然这种情况的概率相当低。</p><p>比起单纯的RAID 6，RAID 60的上层透过结合多组RAID 6构成Stripe访问，因此性能较高。不过使用门槛高，而且容量利用率低是较大的问题。</p></p><h2 id="软RAID和硬RAID"><a href="#软RAID和硬RAID" class="headerlink" title="软RAID和硬RAID"></a>软RAID和硬RAID</h2><p>根据实现模式，RAID又分为软RAID和硬RAID。</p><h3 id="软件磁盘阵列（Software-RAID）"><a href="#软件磁盘阵列（Software-RAID）" class="headerlink" title="软件磁盘阵列（Software RAID）"></a>软件磁盘阵列（Software RAID）</h3><p>主要由CPU处理数组存储作业，缺点为耗损较多CPU资源运算RAID，优点则是价格偏低。分类有3种：</p><p>基于主板的磁盘阵列：只需要主板支持即可（通常是芯片组内置的RAID功能，如Intel Matrix RAID，Intel Rapid Storage Technology），不需要任何磁盘阵列卡。若主板损坏，可能难以购买同款主板重建RAID。</p><p>硬件辅助磁盘阵列（Hardware-Assisted RAID）：需要一张基于Fake RAID的RAID卡，以及厂商所提供的驱动程序，但此类RAID卡仍然通过CPU进行运算。这款RAID较易迁移到其他电脑。RAID功能靠运行于操作系统的厂商驱动程序和CPU运算提供。</p><p>操作系统的RAID功能：如Linux、FreeBSD、Windows Server等操作系统内置RAID功能。</p><h3 id="硬件磁盘阵列（Hardware-RAID）"><a href="#硬件磁盘阵列（Hardware-RAID）" class="headerlink" title="硬件磁盘阵列（Hardware RAID）"></a>硬件磁盘阵列（Hardware RAID）</h3><p>RAID卡上内置处理器，不需要服务器的CPU运算。优点是读写性能最快，不占用服务器资源，可用于任何操作系统，也能在系统断电后，透过备份电池模块（BBU, Backup Battery Unit）以及非易失性存储器 (NVRAM)将硬盘读写日志档（Journal）包含的剩余读写作业先记录在存储器中，等待电力供应撤销后，再由NVRAM取回日志档数据，接着再完成读写作业，将剩余读写作业安全完成以确保读写完整性。备份电池模块通常会配合数组卡的Write-Back缓存模式，借由此存储器缓存读写作业以得到更高的读写性能；但是没有备份电池模块的硬件磁盘阵列卡，切勿使用Write-Back缓存模式以免遭遇断电情形导致读写数据流失。此外，因为硬件磁盘阵列卡搭载内置处理器，所以可以与操作系统分离出来，对硬盘进行各种作业，还原作业的速度也比软件磁盘阵列快。缺点是其售价很高。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;因为安装了黑群晖，需要做一个raid来保证数据的安全和完整，便了解了下raid的原理。&lt;br&gt;参考：&lt;a href</summary>
      
    
    
    
    <category term="RAID" scheme="http://junonin.github.io/categories/RAID/"/>
    
    
    <category term="RAID" scheme="http://junonin.github.io/tags/RAID/"/>
    
  </entry>
  
  <entry>
    <title>SqlServer 更改数据库名称</title>
    <link href="http://junonin.github.io/posts/ab2a9e10.html"/>
    <id>http://junonin.github.io/posts/ab2a9e10.html</id>
    <published>2020-11-30T02:04:02.000Z</published>
    <updated>2020-11-30T02:22:37.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote><p>数据库因为一开始命名不规范，导致后来需要修改数据库名称<br>参考：<a href="https://www.cnblogs.com/xuyufeng/p/9197137.html">SqlServer 更改数据库名称</a></p></blockquote><h2 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h2><ul><li>1.首先选中需要更改数据库右击属性找到文件，可直接修改数据库逻辑名称</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://s3.ax1x.com/2020/11/30/D2Cq8e.png"></p><ul><li><p>2.选中数据库右击选择重命名修改数据库名称。 (必要时候需要改成单用户模式)</p></li><li><p>3.将数据库进行分离，找到数据库文件mdf与ldf文件，直接更改文件名称</p></li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://s3.ax1x.com/2020/11/30/D2PcZt.png"></p><ul><li>4.附加数据库回来（此处注意需要重新选择物理文件路径，默认的为原先老的文件名）</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://s3.ax1x.com/2020/11/30/D2PfJS.png"></p>]]></content>
    
    
    <summary type="html">SqlServer 更改数据库名称</summary>
    
    
    
    <category term="SQL" scheme="http://junonin.github.io/categories/SQL/"/>
    
    
    <category term="SQL" scheme="http://junonin.github.io/tags/SQL/"/>
    
  </entry>
  
  <entry>
    <title>WebService</title>
    <link href="http://junonin.github.io/posts/c05121c7.html"/>
    <id>http://junonin.github.io/posts/c05121c7.html</id>
    <published>2020-11-27T08:30:14.000Z</published>
    <updated>2020-11-27T08:37:39.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote><p>WebService学习记录<br>因为公司的WebService是用.net做的，业务端是用java来显示，需要将WebService转成jar包调用。</p></blockquote><h2 id="Webservice"><a href="#Webservice" class="headerlink" title="Webservice"></a>Webservice</h2><p>可以使用Eclipse的<strong>Web Service Client</strong>生成代码</p><p>默认生成的代码不带认证信息 </p><p>需要添加 -XadditionalHeaders  参数</p><p>生成jar包  D:\Doc  使用wsimport的-clientjar  不包含源码打包成jar</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsimport -keep -d D:\Doc -s D:\Doc -p com.yd.service -clientjar D:\Doc\service-1.0.3.jar -encoding utf-8 -verbose -XadditionalHeaders http://192.168.1.131:33046/YdDatacenterCloud.CloudCenter/CloudWebServicer/?wsdl</span><br></pre></td></tr></table></figure><p>生成jar包  D:\Doc 包含源码打包成jar</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsimport -keep -d D:\Doc -s D:\Doc -p com.yd.service -encoding utf-8 -verbose -XadditionalHeaders http://www.xxxxxx.com:xxx/ServerService?wsdl</span><br></pre></td></tr></table></figure><p>在D:\Doc目录下启动命令行将com和META-INF一起打成jar包</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jar cvf service-1.0.2.jar com META-INF</span><br></pre></td></tr></table></figure><p>更新MANIFEST.MF文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jar cvf service-1.0.2.jar com</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jar -uvfm service-V1.0.0.jar MANIFEST.MF</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">WebService</summary>
    
    
    
    <category term="WebService" scheme="http://junonin.github.io/categories/WebService/"/>
    
    
    <category term="WebService" scheme="http://junonin.github.io/tags/WebService/"/>
    
  </entry>
  
  <entry>
    <title>删除Maven下无效的lastUpdated文件</title>
    <link href="http://junonin.github.io/posts/b5aff3ae.html"/>
    <id>http://junonin.github.io/posts/b5aff3ae.html</id>
    <published>2020-11-27T03:06:53.000Z</published>
    <updated>2020-11-27T03:11:56.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote><p>删除maven仓库中大量未下载成功的.lastUpdated文件。<br>参考：<a href="https://www.cnblogs.com/cxzdy/p/5662161.html">删除maven仓库中的LastUpdated文件</a></p></blockquote><h2 id="bat脚本"><a href="#bat脚本" class="headerlink" title="bat脚本"></a>bat脚本</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@echo off</span><br><span class="line">rem REPOSITORY_PATH是Maven的路径</span><br><span class="line">set REPOSITORY_PATH=D:\M2</span><br><span class="line">rem 正在搜索...</span><br><span class="line">for /f &quot;delims=&quot; %%i in (&#x27;dir /b /s &quot;%REPOSITORY_PATH%\*lastUpdated*&quot;&#x27;) do (</span><br><span class="line">    del /s /q %%i</span><br><span class="line">)</span><br><span class="line">rem 搜索完毕</span><br><span class="line">::pause</span><br><span class="line"></span><br></pre></td></tr></table></figure><div class="note red icon simple"><i class="note-icon fas fa-fan"></i><p>附录：<a href="https://juno.lanzous.com/iyn3Dithizc">bat脚本下载</a></p></div>]]></content>
    
    
    <summary type="html">删除Maven下无效的lastUpdated文件</summary>
    
    
    
    <category term="Maven" scheme="http://junonin.github.io/categories/Maven/"/>
    
    
    <category term="Maven" scheme="http://junonin.github.io/tags/Maven/"/>
    
  </entry>
  
  <entry>
    <title>数据库服务器情况</title>
    <link href="http://junonin.github.io/posts/9b7af42.html"/>
    <id>http://junonin.github.io/posts/9b7af42.html</id>
    <published>2020-11-27T02:12:12.000Z</published>
    <updated>2020-11-27T02:35:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote><p>想了了解数据库目前的连接池情况和日志文件占用情况</p></blockquote><h2 id="连接池情况"><a href="#连接池情况" class="headerlink" title="连接池情况"></a>连接池情况</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> master.dbo.sysprocesses</span><br><span class="line"><span class="keyword">where</span> dbid = DB_ID(<span class="string">&#x27;database&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> @@MAX_CONNECTIONS</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> @@CONNECTIONS</span><br><span class="line"></span><br><span class="line">sp_who <span class="string">&#x27;sa&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> spid,ecid,<span class="keyword">status</span>,loginame,hostname,cmd,request_id</span><br><span class="line"><span class="keyword">from</span> sys.sysprocesses <span class="keyword">where</span> loginame=<span class="string">&#x27;sa&#x27;</span> <span class="keyword">and</span> hostname=<span class="string">&#x27;JUNO&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="日志文件占用情况"><a href="#日志文件占用情况" class="headerlink" title="日志文件占用情况"></a>日志文件占用情况</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">DBCC SQLPERF(LOGSPACE)</span><br><span class="line"></span><br><span class="line">DBCC showfilestats</span><br><span class="line"></span><br><span class="line">Exec sp_spaceused</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> a.name [文件名称]</span><br><span class="line">,<span class="keyword">cast</span>(a.[<span class="keyword">size</span>]*<span class="number">1.0</span>/<span class="number">128</span> <span class="keyword">as</span> <span class="built_in">decimal</span>(<span class="number">12</span>,<span class="number">1</span>)) <span class="keyword">AS</span> [文件设置大小(MB)]</span><br><span class="line">,<span class="keyword">CAST</span>( fileproperty(s.name,<span class="string">&#x27;SpaceUsed&#x27;</span>)/(<span class="number">8</span>*<span class="number">16.0</span>) <span class="keyword">AS</span> <span class="built_in">DECIMAL</span>(<span class="number">12</span>,<span class="number">1</span>)) <span class="keyword">AS</span> [文件所占空间(MB)]</span><br><span class="line">,<span class="keyword">CAST</span>( (fileproperty(s.name,<span class="string">&#x27;SpaceUsed&#x27;</span>)/(<span class="number">8</span>*<span class="number">16.0</span>))/(s.size/(<span class="number">8</span>*<span class="number">16.0</span>))*<span class="number">100.0</span>  <span class="keyword">AS</span> <span class="built_in">DECIMAL</span>(<span class="number">12</span>,<span class="number">1</span>)) <span class="keyword">AS</span> [所占空间率%]</span><br><span class="line">,<span class="keyword">CASE</span> <span class="keyword">WHEN</span> A.growth =<span class="number">0</span> <span class="keyword">THEN</span> <span class="string">&#x27;文件大小固定，不会增长&#x27;</span> <span class="keyword">ELSE</span> <span class="string">&#x27;文件将自动增长&#x27;</span> <span class="keyword">end</span> [增长模式]</span><br><span class="line">,<span class="keyword">CASE</span> <span class="keyword">WHEN</span> A.growth &gt; <span class="number">0</span> <span class="keyword">AND</span> is_percent_growth = <span class="number">0</span> <span class="keyword">THEN</span> <span class="string">&#x27;增量为固定大小&#x27;</span></span><br><span class="line"><span class="keyword">WHEN</span> A.growth &gt; <span class="number">0</span> <span class="keyword">AND</span> is_percent_growth = <span class="number">1</span> <span class="keyword">THEN</span> <span class="string">&#x27;增量将用整数百分比表示&#x27;</span></span><br><span class="line"><span class="keyword">ELSE</span> <span class="string">&#x27;文件大小固定，不会增长&#x27;</span> <span class="keyword">END</span> <span class="keyword">AS</span> [增量模式]</span><br><span class="line">,<span class="keyword">CASE</span> <span class="keyword">WHEN</span> A.growth &gt; <span class="number">0</span> <span class="keyword">AND</span> is_percent_growth = <span class="number">0</span> <span class="keyword">THEN</span> <span class="keyword">cast</span>(<span class="keyword">cast</span>(a.growth*<span class="number">1.0</span>/<span class="number">128</span><span class="keyword">as</span> <span class="built_in">decimal</span>(<span class="number">12</span>,<span class="number">0</span>)) <span class="keyword">AS</span> <span class="built_in">VARCHAR</span>)+<span class="string">&#x27;MB&#x27;</span></span><br><span class="line"><span class="keyword">WHEN</span> A.growth &gt; <span class="number">0</span> <span class="keyword">AND</span> is_percent_growth = <span class="number">1</span> <span class="keyword">THEN</span> <span class="keyword">cast</span>(<span class="keyword">cast</span>(a.growth <span class="keyword">AS</span> <span class="built_in">decimal</span>(<span class="number">12</span>,<span class="number">0</span>)) <span class="keyword">AS</span> <span class="built_in">VARCHAR</span>)+<span class="string">&#x27;%&#x27;</span></span><br><span class="line"><span class="keyword">ELSE</span> <span class="string">&#x27;文件大小固定，不会增长&#x27;</span> <span class="keyword">end</span> <span class="keyword">AS</span> [增长值(%或MB)]</span><br><span class="line">,a.physical_name <span class="keyword">AS</span> [文件所在目录]</span><br><span class="line">,a.type_desc <span class="keyword">AS</span> [文件类型]</span><br><span class="line"><span class="keyword">FROM</span> sys.database_files  a</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> sys.sysfiles <span class="keyword">AS</span> s <span class="keyword">ON</span> a.[file_id]=s.fileid</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> sys.dm_db_file_space_usage b <span class="keyword">ON</span> a.[file_id]=b.[file_id]</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> a.[<span class="keyword">type</span>]</span><br></pre></td></tr></table></figure><div class="note red icon simple"><i class="note-icon fas fa-fan"></i><p>附录：<a href="https://juno.lanzous.com/i2l1zitgpib">SQL下载</a></p></div>]]></content>
    
    
    <summary type="html">数据库服务器情况，日志文件占用情况，连接池情况</summary>
    
    
    
    <category term="SQL" scheme="http://junonin.github.io/categories/SQL/"/>
    
    
    <category term="SQL" scheme="http://junonin.github.io/tags/SQL/"/>
    
  </entry>
  
  <entry>
    <title>一些Bat的备份脚本</title>
    <link href="http://junonin.github.io/posts/6ad92fda.html"/>
    <id>http://junonin.github.io/posts/6ad92fda.html</id>
    <published>2020-11-26T09:34:00.000Z</published>
    <updated>2020-11-27T02:29:10.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote><p>因为需要主从盘，跨服务器之类的备份，记录一下常用的备份脚本<br>参考：<a href="https://www.bandisoft.com/bandizip/help/parameter/">Bandizip 命令行参数</a><br>参考：<a href="https://www.cnblogs.com/lidabo/archive/2012/08/10/2632219.html">Winrar 命令行参数</a></p></blockquote><h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><ul><li>一个备份到从盘的demo<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@echo off</span><br><span class="line">rem echo是off 不打印注释rem</span><br><span class="line">::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span><br><span class="line">::     备份Tomcat</span><br><span class="line">::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span><br><span class="line">title  备份Tomcat</span><br><span class="line"></span><br><span class="line">set rar=E:\backup\</span><br><span class="line">rem 根据时间在E:\backup\创建当天的新文件夹  例：20200512</span><br><span class="line">set data=%date:~0,4%%date:~5,2%%date:~8,2%</span><br><span class="line">md %rar%%data%</span><br><span class="line"></span><br><span class="line">rem 利用Bandizip做从盘备份</span><br><span class="line">Bandizip bc -aoa -o:%rar%%data%\ D:\Tomcat8-01 D:\Tomcat8-02 D:\Tomcat8-03 D:\Tomcat8-04 D:\Tomcat8-05 </span><br><span class="line">rem D:\Tomcat8-01 → E:\backup\20200512\Tomcat8-01.zip</span><br><span class="line">rem D:\Tomcat8-02 → E:\backup\20200512\Tomcat8-02.zip</span><br><span class="line">rem D:\Tomcat8-03 → E:\backup\20200512\Tomcat8-03.zip</span><br><span class="line"></span><br><span class="line">rem 删除备份目录下7天前的文件（目录为E:\backup）</span><br><span class="line">forfiles /p &quot;E:\backup&quot; /s /m *.* /d -7 /c &quot;cmd /c del @path&quot;</span><br><span class="line"></span><br><span class="line">rem pause</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><div class="note danger modern"><p>删除某个目录下系统文件修改日期七天前的</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rem 删除C:\sql back目录下7天前的*.dbb *.bak文件</span><br><span class="line">Forfiles /p &quot;c:\sql back&quot; /s /d -7 /m *.dbb /c &quot;cmd /c del /q /f @path&quot;</span><br><span class="line">Forfiles /p &quot;c:\sql back&quot; /s /d -7 /m *.bak /c &quot;cmd /c del /q /f @path&quot;</span><br></pre></td></tr></table></figure></div></li></ul><div class="note red icon simple"><i class="note-icon fas fa-fan"></i><p>附录：<a href="https://juno.lanzous.com/iFH4jirht5g">Winrar下载</a><br>附录：<a href="https://juno.lanzous.com/icO91irht7i">Bandizip下载</a></p></div>]]></content>
    
    
    <summary type="html">备份后自动压缩脚本，winrar命令行压缩，bandizip命令行压缩</summary>
    
    
    
    <category term="Bat" scheme="http://junonin.github.io/categories/Bat/"/>
    
    
    <category term="Bat" scheme="http://junonin.github.io/tags/Bat/"/>
    
  </entry>
  
  <entry>
    <title>批量备份数据库</title>
    <link href="http://junonin.github.io/posts/2e2ac8a6.html"/>
    <id>http://junonin.github.io/posts/2e2ac8a6.html</id>
    <published>2020-11-26T08:21:17.000Z</published>
    <updated>2020-11-27T02:28:36.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote><p>一些业务服务器在同一个服务器上很久没有做全量备份了，需要临时备份一次，就想做一个脚本全部备份一次。<br>参考：<a href="https://www.cnblogs.com/gaizai/p/3542898.html">SQL Server 批量完整备份</a></p></blockquote><h2 id="单库备份"><a href="#单库备份" class="headerlink" title="单库备份"></a>单库备份</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> datacenter</span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span> @SqlBackupDataBase <span class="keyword">as</span> <span class="keyword">nvarchar</span>(<span class="number">1000</span>)</span><br><span class="line"><span class="comment">--根据时间拼接bak名称，形成备份语句</span></span><br><span class="line"><span class="keyword">set</span> @SqlBackupDataBase=N<span class="string">&#x27;BACKUP DATABASE Gd_datacenter TO DISK = &#x27;&#x27;F:\backup\Gd_datacenter-&#x27;</span>+</span><br><span class="line"><span class="keyword">CONVERT</span>(<span class="built_in">varchar</span>(<span class="number">10</span>),<span class="keyword">GETDATE</span>(),<span class="number">120</span>)+<span class="string">&#x27;Full.bak&#x27;&#x27;WITH FORMAT, NAME = N&#x27;&#x27;Gd_datacenter_Full_&#x27;</span> + </span><br><span class="line"><span class="keyword">CONVERT</span>(<span class="built_in">varchar</span>(<span class="number">10</span>),<span class="keyword">GETDATE</span>(),<span class="number">120</span>)+<span class="string">&#x27;&#x27;&#x27; </span></span><br><span class="line"><span class="string">&#x27;</span></span><br><span class="line"><span class="comment">--备份文件格式</span></span><br><span class="line">print @SqlBackupDataBase <span class="comment">--打印出来（为了方便调试，可省略）</span></span><br><span class="line">exec sp_executesql @SqlBackupDataBase </span><br></pre></td></tr></table></figure><h2 id="批量备份"><a href="#批量备份" class="headerlink" title="批量备份"></a>批量备份</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">DECLARE</span></span><br><span class="line">      @FileName <span class="built_in">VARCHAR</span>(<span class="number">200</span>),</span><br><span class="line">      @CurrentTime <span class="built_in">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">      @DBName <span class="built_in">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">      @<span class="keyword">SQL</span> <span class="built_in">VARCHAR</span>(<span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> @CurrentTime = <span class="keyword">CONVERT</span>(<span class="built_in">CHAR</span>(<span class="number">8</span>),<span class="keyword">GETDATE</span>(),<span class="number">112</span>) + <span class="keyword">CAST</span>(<span class="keyword">DATEPART</span>(hh, <span class="keyword">GETDATE</span>()) <span class="keyword">AS</span> <span class="built_in">VARCHAR</span>) + <span class="keyword">CAST</span>(<span class="keyword">DATEPART</span>(mi, <span class="keyword">GETDATE</span>()) <span class="keyword">AS</span> <span class="built_in">VARCHAR</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">DECLARE</span> CurDBName <span class="keyword">CURSOR</span> <span class="keyword">FOR</span> </span><br><span class="line">    <span class="keyword">SELECT</span> <span class="keyword">NAME</span> <span class="keyword">FROM</span> Master..SysDatabases <span class="keyword">where</span> dbid&gt;<span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">OPEN</span> CurDBName</span><br><span class="line"><span class="keyword">FETCH</span> <span class="keyword">NEXT</span> <span class="keyword">FROM</span> CurDBName <span class="keyword">INTO</span> @DBName</span><br><span class="line"><span class="keyword">WHILE</span> @@FETCH_STATUS = <span class="number">0</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="comment">--Execute Backup</span></span><br><span class="line">    <span class="comment">--保存bak的位置可以更改</span></span><br><span class="line">    <span class="keyword">SET</span> @FileName = <span class="string">&#x27;E:\DBBackup\&#x27;</span> + @DBName + <span class="string">&#x27;_&#x27;</span> + @CurrentTime</span><br><span class="line">    <span class="keyword">SET</span> @<span class="keyword">SQL</span> = <span class="string">&#x27;BACKUP DATABASE [&#x27;</span>+ @DBName +<span class="string">&#x27;] TO DISK = &#x27;&#x27;&#x27;</span> + @FileName + <span class="string">&#x27;.bak&#x27;</span> +</span><br><span class="line">     <span class="string">&#x27;&#x27;&#x27; WITH NOINIT, NOUNLOAD, NAME = N&#x27;&#x27;&#x27;</span> + @DBName + <span class="string">&#x27;_backup&#x27;&#x27;, NOSKIP, STATS = 10, NOFORMAT&#x27;</span></span><br><span class="line">    EXEC(@<span class="keyword">SQL</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">--Get Next DataBase</span></span><br><span class="line">    <span class="keyword">FETCH</span> <span class="keyword">NEXT</span> <span class="keyword">FROM</span> CurDBName <span class="keyword">INTO</span> @DBName</span><br><span class="line"><span class="keyword">END</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CLOSE</span> CurDBName</span><br><span class="line"><span class="keyword">DEALLOCATE</span> CurDBName</span><br><span class="line"></span><br></pre></td></tr></table></figure><div class="note red icon simple"><i class="note-icon fas fa-fan"></i><p>附录：<a href="https://juno.lanzous.com/iPwKeiso2da">SQL下载</a></p></div>]]></content>
    
    
    <summary type="html">批量备份数据库</summary>
    
    
    
    <category term="SQL" scheme="http://junonin.github.io/categories/SQL/"/>
    
    
    <category term="SQL" scheme="http://junonin.github.io/tags/SQL/"/>
    
  </entry>
  
  <entry>
    <title>Redis</title>
    <link href="http://junonin.github.io/posts/7b25d017.html"/>
    <id>http://junonin.github.io/posts/7b25d017.html</id>
    <published>2020-11-25T10:02:03.000Z</published>
    <updated>2020-11-24T10:07:25.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote><p>Redis学习记录</p></blockquote><h2 id="Redis下载"><a href="#Redis下载" class="headerlink" title="Redis下载"></a>Redis下载</h2><blockquote><p><strong><a href="https://github.com/MicrosoftArchive/redis/releases">Windows下载地址3.x.x</a></strong></p><p><strong><a href="https://github.com/tporadowski/redis/releases">Windows下载地址5.x.x</a></strong></p></blockquote><h2 id="Windows下配置"><a href="#Windows下配置" class="headerlink" title="Windows下配置"></a>Windows下配置</h2><blockquote><h5 id="redis-windows-conf文件配置密码"><a href="#redis-windows-conf文件配置密码" class="headerlink" title="redis.windows.conf文件配置密码"></a><strong>redis.windows.conf</strong>文件配置密码</h5><h5 id="requirepass-password-你的密码"><a href="#requirepass-password-你的密码" class="headerlink" title="requirepass password(你的密码)"></a>requirepass password(你的密码)</h5></blockquote><p>Windows下启动</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"><span class="built_in">cd</span> /d D:\Redis-x64-3.2.100[替换为你的redis路径]</span><br><span class="line"></span><br><span class="line">start redis-server.exe redis.windows.conf</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> redis start...</span><br><span class="line">::pause</span><br></pre></td></tr></table></figure><p>在Redis目录下运行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli.exe -h 127.0.0.1 -p 6379</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span>  key  abc</span><br><span class="line"></span><br><span class="line">get  key </span><br></pre></td></tr></table></figure><h2 id="Redis服务安装"><a href="#Redis服务安装" class="headerlink" title="Redis服务安装"></a>Redis服务安装</h2><ul><li>进入Redis安装包目录，cmd安装服务</li></ul><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-server --service-install redis.windows-service.conf --loglevel verbose</span><br></pre></td></tr></table></figure><p>提示 Redistribution successfully installed as a service.即安装成功</p><p><img src= "/img/loading.gif" data-lazy-src="https://s2.ax1x.com/2019/11/21/MIOn29.png"></p>]]></content>
    
    
    <summary type="html">Redis，Redis服务，Redis-windows</summary>
    
    
    
    <category term="Redis" scheme="http://junonin.github.io/categories/Redis/"/>
    
    
    <category term="Redis" scheme="http://junonin.github.io/tags/Redis/"/>
    
  </entry>
  
  <entry>
    <title>Tomcat服务</title>
    <link href="http://junonin.github.io/posts/9240bb8c.html"/>
    <id>http://junonin.github.io/posts/9240bb8c.html</id>
    <published>2020-11-24T08:41:27.000Z</published>
    <updated>2020-11-24T08:57:02.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote><p>Tomcat服务，异常处理笔记</p></blockquote><h2 id="Tomcat安装卸载服务"><a href="#Tomcat安装卸载服务" class="headerlink" title="Tomcat安装卸载服务"></a>Tomcat安装卸载服务</h2><p>安装 cmd 根目录    <code>service.bat install Tomcat9</code></p><p>卸载cmd根目录    <code>service.bat remove Tomcat9</code></p><h2 id="Nt-Kernel-amp-System-占用80端口"><a href="#Nt-Kernel-amp-System-占用80端口" class="headerlink" title="Nt Kernel &amp; System 占用80端口"></a>Nt Kernel &amp; System 占用80端口</h2><p><code>net stop http 按Y 确定</code></p><p><code>Sc config http start= disabled</code></p><p>重启Apache</p><h2 id="Tomcat8080端口无法启动"><a href="#Tomcat8080端口无法启动" class="headerlink" title="Tomcat8080端口无法启动"></a>Tomcat8080端口无法启动</h2><p>查看端口占用情况<br><code>netstat -ano|findstr 8080</code></p><p>删除占用端口的PID<br><code>taskkill /pid 18352 /f</code></p><ul><li>强制关闭8080端口</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line">setlocal enabledelayedexpansion</span><br><span class="line">rem 8080端口</span><br><span class="line"><span class="keyword">for</span> /f <span class="string">&quot;delims=  tokens=1&quot;</span> %%i <span class="keyword">in</span> (<span class="string">&#x27;netstat -aon ^| findstr &quot;8080&quot;&#x27;</span>) <span class="keyword">do</span> (</span><br><span class="line"><span class="built_in">set</span> a=%%i</span><br><span class="line">goto js</span><br><span class="line">)</span><br><span class="line">:js</span><br><span class="line">taskkill /f /pid <span class="string">&quot;!a:~71,5!&quot;</span></span><br><span class="line">pause&gt;nul</span><br></pre></td></tr></table></figure><h2 id="Tomcat部署WAR包访问不带项目名的方式"><a href="#Tomcat部署WAR包访问不带项目名的方式" class="headerlink" title="Tomcat部署WAR包访问不带项目名的方式"></a>Tomcat部署WAR包访问不带项目名的方式</h2><ol><li><p>将项目打成WAR包放在Tomcat的webapps目录下</p></li><li><p>在Tomcat的安装目录的conf下找到server.xml的文件，如：D:\apache-tomcat-9.0.8\conf\server.xml</p></li><li><p>在Host标签里边添加</p></li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Host</span> <span class="attr">name</span>=<span class="string">&quot;localhost&quot;</span>  <span class="attr">appBase</span>=<span class="string">&quot;webapps&quot;</span> <span class="attr">unpackWARs</span>=<span class="string">&quot;true&quot;</span> <span class="attr">autoDeploy</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="tag">&lt;<span class="name">Context</span> <span class="attr">path</span>=<span class="string">&quot;&quot;</span> <span class="attr">docBase</span>=<span class="string">&quot;myproject&quot;</span> <span class="attr">reloadable</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">    </span><br><span class="line"> <span class="tag">&lt;/<span class="name">Host</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>Context标签内容，注意path填空，docBase为项目名称</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">&quot;8080&quot;</span> <span class="attr">protocol</span>=<span class="string">&quot;HTTP/1.1&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">connectionTimeout</span>=<span class="string">&quot;20000&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">redirectPort</span>=<span class="string">&quot;8443&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><ul><li>在此可以修改port的默认端口名8080</li></ul><ol start="4"><li>再次访问即可携带项目名称或不带都可以访问到项目。如localhost:8080/或localhost:8080/myproject</li></ol><h2 id="webapps"><a href="#webapps" class="headerlink" title="webapps"></a>webapps</h2><blockquote><p><strong><em>webapps</em>是用来存放运行工程的目录</strong></p></blockquote><ol><li>在服务器上部署web项目时，直接将项目war包放入tomcat中的webapps文件下后重启tomcat后，war包会自动解压，这时访问项目的地址是ip+端口+<strong>项目名称</strong>就可以正常访问项目。</li></ol><p>注：webapps目录和放在ROOT目录的区别是webapps不需要解压，ROOT需要解压；webapps访问项目需要加项目名，ROOT不需要加项目名。</p><h2 id="Tomcat的加载运行机制"><a href="#Tomcat的加载运行机制" class="headerlink" title="Tomcat的加载运行机制"></a>Tomcat的加载运行机制</h2><ol><li><p>Tomcat_Home/lib目录下的jar包</p></li><li><p>然后加载 Tomcat_Home/ webapps/项目名/WEB-NF/lib的jar包</p></li><li><p>最后加载的是 Tomcat_HOME/webapps/项目名/WEB-INF/ classes下的类文件</p></li></ol><div class="note danger modern"><ul><li>注：本机的 Tomcat_HOME为你本机的Tomcat路径</li><li>关键是： Tomcat 按上述顺序依次加载资源，当后加载的资源与之前加载的资源相重时，后加载的资源会继续加载并将之前的资源覆盖</li></ul></div><div class="note red icon simple"><i class="note-icon fas fa-fan"></i><p>附录：<a href="https://juno.lanzous.com/igmH6iq3vra">Kill8080.bat下载</a></p></div>]]></content>
    
    
    <summary type="html">Tomcat服务，端口占用，部署webapp</summary>
    
    
    
    <category term="JAVA" scheme="http://junonin.github.io/categories/JAVA/"/>
    
    <category term="JDK" scheme="http://junonin.github.io/categories/JAVA/JDK/"/>
    
    
    <category term="Tomcat" scheme="http://junonin.github.io/tags/Tomcat/"/>
    
  </entry>
  
  <entry>
    <title>如何用SQL来核查序号是否连续</title>
    <link href="http://junonin.github.io/posts/2b21e7e.html"/>
    <id>http://junonin.github.io/posts/2b21e7e.html</id>
    <published>2020-11-24T07:01:15.000Z</published>
    <updated>2020-11-24T08:53:14.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote><p>设置了自增id的数据，想查询哪个id被删除了，导致不连续</p></blockquote><h2 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span>+<span class="number">1</span> <span class="keyword">from</span> TableName</span><br><span class="line"><span class="keyword">where</span> <span class="keyword">id</span>+<span class="number">1</span> <span class="keyword">not</span> <span class="keyword">in</span>(<span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> TableName)</span><br><span class="line"><span class="keyword">and</span> <span class="keyword">id</span>+<span class="number">1</span>&lt;&gt;(<span class="keyword">select</span> <span class="keyword">max</span>(<span class="keyword">id</span>)+<span class="number">1</span> <span class="keyword">from</span> TableName)</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">如何用SQL来核查序号是否连续</summary>
    
    
    
    <category term="SQL" scheme="http://junonin.github.io/categories/SQL/"/>
    
    
    <category term="SQL" scheme="http://junonin.github.io/tags/SQL/"/>
    
  </entry>
  
  <entry>
    <title>索引重建</title>
    <link href="http://junonin.github.io/posts/10d7ac37.html"/>
    <id>http://junonin.github.io/posts/10d7ac37.html</id>
    <published>2020-11-20T03:13:36.000Z</published>
    <updated>2020-11-27T02:28:46.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote><p>因为数据库插入的时候执行时间过长，通过DBCC SHOWCONTIG看到Scan Density <strong>扫描密度</strong> 指标过低，需要利用DBCC DBREINDEX重建索引提高SQL Server性能<br>参考：<a href="https://blog.csdn.net/wangjunhe/article/details/7228208">DBCC SHOWCONTIG 索引碎片查询</a></p></blockquote><h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><ul><li>因为需要遍历整个数据库，然后分析其中的Scan Density低于90%的表，才需要进行做DBCC DBREINDEX，我用了一张临时表，然后将低于90%的数据插入，再遍历出来做DBCC DBREINDEX，最后再删除临时表，如下：<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/*注意执行的时候会导致表锁死，请谨慎操作*/</span></span><br><span class="line"><span class="comment">/*批量重建当前库的所有表中扫描密度低于90%*/</span></span><br><span class="line"> IF object_id(&#x27;tempdb..<span class="comment">#temp&#x27;) is not null </span></span><br><span class="line"> <span class="keyword">Begin</span></span><br><span class="line"> <span class="comment">--判断临时表是否存在</span></span><br><span class="line">       <span class="keyword">DROP</span> <span class="keyword">TABLE</span>  <span class="comment">#temp</span></span><br><span class="line"> <span class="keyword">End</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">DECLARE</span> @tablename <span class="built_in">VARCHAR</span> (<span class="number">128</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">--创建临时表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="comment">#temp (</span></span><br><span class="line">ObjectName <span class="built_in">CHAR</span> ( <span class="number">255</span> ),</span><br><span class="line">ObjectId <span class="built_in">INT</span>,</span><br><span class="line">IndexName <span class="built_in">CHAR</span> ( <span class="number">255</span> ),</span><br><span class="line">IndexId <span class="built_in">INT</span>,</span><br><span class="line">Lvl <span class="built_in">INT</span>,</span><br><span class="line">CountPages <span class="built_in">INT</span>,</span><br><span class="line">CountRows <span class="built_in">INT</span>,</span><br><span class="line">MinRecSize <span class="built_in">INT</span>,</span><br><span class="line">MaxRecSize <span class="built_in">INT</span>,</span><br><span class="line">AvgRecSize <span class="built_in">INT</span>,</span><br><span class="line">ForRecCount <span class="built_in">INT</span>,</span><br><span class="line">Extents <span class="built_in">INT</span>,</span><br><span class="line">ExtentSwitches <span class="built_in">INT</span>,</span><br><span class="line">AvgFreeBytes <span class="built_in">INT</span>,</span><br><span class="line">AvgPageDensity <span class="built_in">INT</span>,</span><br><span class="line">ScanDensity <span class="built_in">DECIMAL</span>,</span><br><span class="line">BestCount <span class="built_in">INT</span>,</span><br><span class="line">ActualCount <span class="built_in">INT</span>,</span><br><span class="line">LogicalFrag <span class="built_in">DECIMAL</span>,</span><br><span class="line">ExtentFrag <span class="built_in">DECIMAL</span> </span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">--创建游标获取所有表名</span></span><br><span class="line"><span class="keyword">DECLARE</span> <span class="keyword">tables</span> <span class="keyword">CURSOR</span> <span class="keyword">FOR</span></span><br><span class="line">   <span class="keyword">SELECT</span> TABLE_NAME</span><br><span class="line">   <span class="keyword">FROM</span> INFORMATION_SCHEMA.TABLES</span><br><span class="line">   <span class="keyword">WHERE</span> TABLE_TYPE = <span class="string">&#x27;BASE TABLE&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">-- 开启游标</span></span><br><span class="line"><span class="keyword">OPEN</span> <span class="keyword">tables</span></span><br><span class="line"><span class="comment">--获取光标位置</span></span><br><span class="line"><span class="keyword">FETCH</span> <span class="keyword">NEXT</span> </span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">tables</span> <span class="keyword">INTO</span> @tablename</span><br><span class="line"> </span><br><span class="line"><span class="comment">--FETCH 语句成功</span></span><br><span class="line"><span class="keyword">WHILE</span> @@FETCH_STATUS = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="comment">--遍历执行DBCC SHOWCONTIG(@table_name)</span></span><br><span class="line">   <span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="comment">#temp </span></span><br><span class="line">   EXEC (<span class="string">&#x27;DBCC SHOWCONTIG (&#x27;&#x27;&#x27;</span> + @tablename + <span class="string">&#x27;&#x27;&#x27;) </span></span><br><span class="line"><span class="string">      WITH FAST, TABLERESULTS, ALL_INDEXES, NO_INFOMSGS&#x27;</span>)</span><br><span class="line">   <span class="keyword">FETCH</span> <span class="keyword">NEXT</span></span><br><span class="line">      <span class="keyword">FROM</span> <span class="keyword">tables</span></span><br><span class="line">      <span class="keyword">INTO</span> @tablename</span><br><span class="line"><span class="keyword">END</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--关闭游标</span></span><br><span class="line"><span class="keyword">CLOSE</span> <span class="keyword">tables</span></span><br><span class="line"><span class="comment">--删除游标</span></span><br><span class="line"><span class="keyword">DEALLOCATE</span> <span class="keyword">tables</span></span><br><span class="line"><span class="comment">--关注BestCount,ActualCount的指标</span></span><br><span class="line"><span class="comment">--select ObjectName,BestCount,ActualCount , cast((BestCount*1.00)/(ActualCount*1.00) as  DECIMAL(18,2)) as result  from #temp where ActualCount &lt;&gt; 0</span></span><br><span class="line"><span class="comment">--DBCC SHOWCONTIG (&#x27;dbo.yd_mp_realdata&#x27;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--DECLARE @tablename VARCHAR (128)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--创建需要重建索引的游标</span></span><br><span class="line"><span class="keyword">DECLARE</span> <span class="keyword">tables</span> <span class="keyword">CURSOR</span> <span class="keyword">FOR</span></span><br><span class="line"><span class="comment">--关注BestCount,ActualCount的指标</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> ObjectName <span class="keyword">FROM</span> <span class="comment">#temp</span></span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">cast</span>((BestCount*<span class="number">1.00</span>)/(ActualCount*<span class="number">1.00</span>) <span class="keyword">as</span>  <span class="built_in">DECIMAL</span>(<span class="number">18</span>,<span class="number">2</span>)) &lt; <span class="number">0.90</span> <span class="keyword">and</span> ActualCount &lt;&gt; <span class="number">0</span></span><br><span class="line"><span class="comment">-- 开启游标</span></span><br><span class="line"><span class="keyword">OPEN</span> <span class="keyword">tables</span></span><br><span class="line"><span class="comment">--获取光标位置</span></span><br><span class="line"><span class="keyword">FETCH</span> <span class="keyword">NEXT</span> </span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">tables</span> <span class="keyword">INTO</span> @tablename</span><br><span class="line"> </span><br><span class="line"><span class="comment">--FETCH 语句成功</span></span><br><span class="line"><span class="keyword">WHILE</span> @@FETCH_STATUS = <span class="number">0</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="comment">--重建索引</span></span><br><span class="line"><span class="comment">--输出表名</span></span><br><span class="line">PRINT @tablename</span><br><span class="line"><span class="comment">--DBCC dbreindex (&#x27;&#x27; + @tablename + &#x27;&#x27;,&#x27;&#x27;,0)</span></span><br><span class="line">EXEC ( <span class="string">&#x27;DBCC DBREINDEX (&#x27;</span> + @tablename + <span class="string">&#x27;,&#x27;&#x27;&#x27;&#x27;,0) WITH NO_INFOMSGS &#x27;</span> )</span><br><span class="line"><span class="keyword">FETCH</span> <span class="keyword">NEXT</span></span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">tables</span></span><br><span class="line"><span class="keyword">INTO</span> @tablename</span><br><span class="line"><span class="keyword">END</span></span><br><span class="line"><span class="comment">--关闭游标</span></span><br><span class="line"><span class="keyword">CLOSE</span> <span class="keyword">tables</span></span><br><span class="line"><span class="comment">--删除游标</span></span><br><span class="line"><span class="keyword">DEALLOCATE</span> <span class="keyword">tables</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="comment">#temp</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2></li><li>操作后可以看到Scan Density <strong>扫描密度</strong> 指标恢复正常<br><img src= "/img/loading.gif" data-lazy-src="https://s3.ax1x.com/2020/11/20/DM5KoR.png" alt="DM5KoR.png"></li></ul><div class="note red icon simple"><i class="note-icon fas fa-fan"></i><p>附录：<a href="https://juno.lanzous.com/irRMgikpved">SQL下载</a></p></div>]]></content>
    
    
    <summary type="html">DBCC DBREINDEX，DBCC SHOWCONTIG，重建索引，索引重建</summary>
    
    
    
    <category term="SQL" scheme="http://junonin.github.io/categories/SQL/"/>
    
    
    <category term="SQL" scheme="http://junonin.github.io/tags/SQL/"/>
    
  </entry>
  
  <entry>
    <title>JDK环境变量</title>
    <link href="http://junonin.github.io/posts/bab53ddd.html"/>
    <id>http://junonin.github.io/posts/bab53ddd.html</id>
    <published>2020-11-12T10:55:42.000Z</published>
    <updated>2020-11-24T08:45:33.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote><p>JDK环境变量设置(JDK脚本bat)</p></blockquote><h2 id="安装JDK"><a href="#安装JDK" class="headerlink" title="安装JDK"></a>安装JDK</h2><ol><li>官网下载JDK安装 <a href="https://www.oracle.com/java/technologies/javase/javase-jdk8-downloads.html">JDK8</a></li><li>JDK默认安装  <em>C:\Program Files\Java\JDK</em> </li></ol><h2 id="配置环境变量"><a href="#配置环境变量" class="headerlink" title="配置环境变量"></a>配置环境变量</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"></span><br><span class="line">::获取管理员权限方法一：</span><br><span class="line">%1 mshta vbscript:CreateObject(<span class="string">&quot;Shell.Application&quot;</span>).ShellExecute(<span class="string">&quot;cmd.exe&quot;</span>,<span class="string">&quot;/c %~s0 ::&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;runas&quot;</span>,1)(window.close)&amp;&amp;<span class="built_in">exit</span></span><br><span class="line"><span class="built_in">cd</span> /d <span class="string">&quot;%~dp0&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">::后面是jdk安装路径，更改成自己的jdk安装路径</span><br><span class="line">setx /M JAVA_HOME <span class="string">&quot;C:\Program Files\Java\JDK&quot;</span></span><br><span class="line"></span><br><span class="line">setx /M CLASSPATH <span class="string">&quot;.;%%JAVA_HOME%%\lib\dt.jar;%%JAVA_HOME%%\lib\tools.jar&quot;</span></span><br><span class="line"></span><br><span class="line">setx /M PATH <span class="string">&quot;%PATH%;%%JAVA_HOME%%\bin&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> 设置成功</span><br><span class="line"></span><br><span class="line">java -version</span><br><span class="line"></span><br><span class="line">pause</span><br></pre></td></tr></table></figure><div class="note red icon simple"><i class="note-icon fas fa-fan"></i><p>附录：<a href="https://juno.lanzous.com/iHWYFibvtnc">bat脚本下载</a></p></div>]]></content>
    
    
    <summary type="html">JDK环境变量，JDK脚本</summary>
    
    
    
    <category term="JAVA" scheme="http://junonin.github.io/categories/JAVA/"/>
    
    <category term="JDK" scheme="http://junonin.github.io/categories/JAVA/JDK/"/>
    
    
    <category term="JDK" scheme="http://junonin.github.io/tags/JDK/"/>
    
  </entry>
  
  <entry>
    <title>数据库的特殊情况处理笔记</title>
    <link href="http://junonin.github.io/posts/a73a1064.html"/>
    <id>http://junonin.github.io/posts/a73a1064.html</id>
    <published>2020-10-26T03:50:25.000Z</published>
    <updated>2020-12-23T08:32:14.124Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote><p>SQL的特殊情况处理笔记</p></blockquote><h2 id="Sql-游标"><a href="#Sql-游标" class="headerlink" title="Sql 游标"></a>Sql 游标</h2><ol><li>游标demo：</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">DECLARE @username varchar(20)</span><br><span class="line">DECLARE cursor_name CURSOR FAST_FORWARD FOR --定义游标</span><br><span class="line">    SELECT TOP 10 Username FROM S_user_tb</span><br><span class="line">OPEN cursor_name --打开游标</span><br><span class="line">FETCH NEXT FROM cursor_name INTO @username  --抓取下一行游标数据</span><br><span class="line">WHILE @@FETCH_STATUS &#x3D; 0</span><br><span class="line">    BEGIN</span><br><span class="line">        PRINT &#39;用户名：&#39;+@username</span><br><span class="line">        FETCH NEXT FROM cursor_name INTO @username</span><br><span class="line">    END</span><br><span class="line">CLOSE cursor_name --关闭游标</span><br><span class="line">DEALLOCATE cursor_name --释放游标</span><br></pre></td></tr></table></figure><h2 id="Convert-Decimal-18-2-0-00-显示-00-前面的0不显示问题"><a href="#Convert-Decimal-18-2-0-00-显示-00-前面的0不显示问题" class="headerlink" title="Convert(Decimal(18,2),0.00) 显示 .00 前面的0不显示问题"></a>Convert(Decimal(18,2),0.00) 显示 .00 前面的0不显示问题</h2><blockquote><p>控制面版 -&gt; 区域和语言选项 -&gt; 区域选项–&gt;其它设置 -&gt; 数字 -&gt; 显示前导零= “0.7”</p></blockquote><ul><li>设置标识列自增开关，然后手动插入指定标识的行。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> identity_insert 表名 <span class="keyword">on</span> <span class="comment">--关闭标识列的自增`</span></span><br></pre></td></tr></table></figure><ul><li>其次：插入你要插入的行并指定标识最后：</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> identity_insert 表名 <span class="keyword">off</span> <span class="comment">--打开标识列的自增`</span></span><br></pre></td></tr></table></figure><ul><li> 重置自增长的起始标号</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dbcc checkident(表名,reseed,数字)</span><br></pre></td></tr></table></figure><h2 id="SQL-SERVER-默认备份路径"><a href="#SQL-SERVER-默认备份路径" class="headerlink" title="SQL SERVER 默认备份路径"></a>SQL SERVER 默认备份路径</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--当前的值是什么：</span></span><br><span class="line"><span class="keyword">DECLARE</span> @BackupDirectory <span class="built_in">VARCHAR</span>(<span class="number">100</span>)</span><br><span class="line">EXEC master..xp_regread @rootkey=<span class="string">&#x27;HKEY_LOCAL_MACHINE&#x27;</span>,</span><br><span class="line">  @<span class="keyword">key</span>=<span class="string">&#x27;SOFTWARE\Microsoft\Microsoft SQL Server\MSSQL11.MSSQLSERVER\MSSQLServer&#x27;</span>,</span><br><span class="line">  @value_name=<span class="string">&#x27;BackupDirectory&#x27;</span>,</span><br><span class="line">  @BackupDirectory=@BackupDirectory <span class="keyword">OUTPUT</span></span><br><span class="line"><span class="keyword">SELECT</span> @BackupDirectory</span><br><span class="line"><span class="comment">--下面的代码是更改值：</span></span><br><span class="line">EXEC master..xp_regwrite</span><br><span class="line">     @rootkey=<span class="string">&#x27;HKEY_LOCAL_MACHINE&#x27;</span>,</span><br><span class="line">     @<span class="keyword">key</span>=<span class="string">&#x27;SOFTWARE\Microsoft\Microsoft SQL Server\MSSQL11.MSSQLSERVER\MSSQLServer&#x27;</span>,</span><br><span class="line">     @value_name=<span class="string">&#x27;BackupDirectory&#x27;</span>,</span><br><span class="line">     @<span class="keyword">type</span>=<span class="string">&#x27;REG_SZ&#x27;</span>,</span><br><span class="line">     @<span class="keyword">value</span>=<span class="string">&#x27;D:\BACKUP&#x27;</span>   <span class="comment">--默认备份路径</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="查询数据库表行数"><a href="#查询数据库表行数" class="headerlink" title="查询数据库表行数"></a>查询数据库表行数</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> A.NAME ,B.ROWS  <span class="keyword">FROM</span> sysobjects  A <span class="keyword">JOIN</span> sysindexes B <span class="keyword">ON</span> A.id = B.id <span class="keyword">WHERE</span> A.xtype = <span class="string">&#x27;U&#x27;</span> <span class="keyword">AND</span> B.indid <span class="keyword">IN</span>(<span class="number">0</span>,<span class="number">1</span>) <span class="keyword">ORDER</span> <span class="keyword">BY</span> B.ROWS <span class="keyword">DESC</span></span><br></pre></td></tr></table></figure><h2 id="当前帐户被锁定"><a href="#当前帐户被锁定" class="headerlink" title="当前帐户被锁定"></a>当前帐户被锁定</h2><blockquote><p>帐户当前被锁定,所以用户 ‘sa’ 登录失败。系统管理员无法将该帐户解锁’解决方法</p><p>如果短时间内不停连接，就会被SQL SERVER误认为是这是攻击，会将此账号锁定。</p><p>要用windows身份验证登录，在查询分析器里输入：</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> LOGIN sa <span class="keyword">ENABLE</span> ;</span><br><span class="line">GO</span><br><span class="line"><span class="keyword">ALTER</span> LOGIN sa <span class="keyword">WITH</span> <span class="keyword">PASSWORD</span> = <span class="string">&#x27;password&#x27;</span> <span class="keyword">unlock</span>, check_policy = <span class="keyword">off</span>,</span><br><span class="line">check_expiration = <span class="keyword">off</span> ;</span><br><span class="line">GO</span><br></pre></td></tr></table></figure><h2 id="查某个表的所有字段"><a href="#查某个表的所有字段" class="headerlink" title="查某个表的所有字段"></a>查某个表的所有字段</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">GROUP_CONCAT</span>(col.COLUMN_NAME)</span><br><span class="line"><span class="keyword">FROM</span> information_schema.COLUMNS <span class="keyword">col</span></span><br><span class="line"><span class="keyword">WHERE</span> col.TABLE_SCHEMA = <span class="string">&#x27;mysql&#x27;</span></span><br><span class="line"> <span class="keyword">AND</span> col.TABLE_NAME = <span class="string">&#x27;user&#x27;</span></span><br><span class="line"> <span class="keyword">AND</span> COLUMN_NAME <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="string">&#x27;created_at&#x27;</span>, <span class="string">&#x27;updated_at&#x27;</span>)</span><br><span class="line"><span class="keyword">INTO</span> @cols;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- select @cols</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> @s = <span class="keyword">CONCAT</span>(<span class="string">&#x27;SELECT &#x27;</span>, @cols, <span class="string">&#x27; FROM mysql.user&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> @s</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="SQLServer-中实现类似MySQL中的group-concat函数的功能"><a href="#SQLServer-中实现类似MySQL中的group-concat函数的功能" class="headerlink" title="SQLServer 中实现类似MySQL中的group_concat函数的功能"></a>SQLServer 中实现类似MySQL中的group_concat函数的功能</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SQLServer中没有MySQL中的group_concat函数，可以把分组的数据连接在一起。</span><br><span class="line">先对a列进行分组，对分组中的b以Xml形式输出，再使用stuff将开关多出的，删掉。</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    a,</span><br><span class="line">    <span class="keyword">stuff</span>((<span class="keyword">SELECT</span> <span class="string">&#x27;,&#x27;</span> + b <span class="keyword">FROM</span> <span class="comment">#tb WHERE a = t.a FOR xml path(&#x27;&#x27;)),1,1,&#x27;&#x27;</span></span><br><span class="line">    )<span class="keyword">AS</span> b <span class="keyword">from</span>  <span class="comment"># tb AS t</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line">    a;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">游标,备份，账户锁定</summary>
    
    
    
    <category term="SQL" scheme="http://junonin.github.io/categories/SQL/"/>
    
    
    <category term="SQL" scheme="http://junonin.github.io/tags/SQL/"/>
    
  </entry>
  
  <entry>
    <title>数据库：删除重复记录（去重）</title>
    <link href="http://junonin.github.io/posts/a73a10a8.html"/>
    <id>http://junonin.github.io/posts/a73a10a8.html</id>
    <published>2020-10-22T03:50:37.000Z</published>
    <updated>2020-12-10T01:44:04.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote><p>因为之前数据库的字段添加了索引，但是没有添加唯一索引约束，导致数据库的日月年数据出现的重复。</p></blockquote><h3 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h3><ul><li>distinct去重</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> * <span class="keyword">from</span> <span class="keyword">table</span> 表名 <span class="keyword">where</span> (条件)</span><br></pre></td></tr></table></figure><ul><li>存在部分字段相同的纪录（有主键id即唯一键）</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">table</span> <span class="keyword">where</span> <span class="keyword">id</span> <span class="keyword">in</span> (<span class="keyword">select</span> <span class="keyword">max</span>(<span class="keyword">id</span>) <span class="keyword">from</span> <span class="keyword">table</span> <span class="keyword">group</span> <span class="keyword">by</span> [去除重复的字段名列表,....])</span><br></pre></td></tr></table></figure><ul><li>存在部分字段相同的纪录（没有唯一键id）</li></ul><blockquote><p>可以利用row_number()建立一个值区分去重</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span></span><br><span class="line">(<span class="keyword">select</span> *, row_number() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> 分组字段 <span class="keyword">order</span> <span class="keyword">by</span> 排序 <span class="keyword">desc</span>) rn <span class="keyword">from</span> 表名) A</span><br><span class="line"><span class="keyword">where</span> rn = <span class="number">1</span></span><br></pre></td></tr></table></figure><h3 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h3><ul><li>top</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> TOP (<span class="number">20</span>) <span class="keyword">from</span> <span class="keyword">table</span> 表名 <span class="keyword">where</span> (条件)</span><br></pre></td></tr></table></figure><ul><li>存在部分字段相同的纪录（有主键id即唯一键）</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> 表名 <span class="keyword">where</span> <span class="keyword">id</span> <span class="keyword">in</span> (</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">min</span>(<span class="keyword">id</span>) <span class="keyword">from</span> 表名 <span class="keyword">group</span> <span class="keyword">by</span> [去除重复的字段名列表,....]</span><br><span class="line"><span class="keyword">having</span>  <span class="keyword">count</span>(<span class="number">1</span>)&gt;<span class="number">1</span> )</span><br></pre></td></tr></table></figure><ul><li>存在部分字段相同的纪录（没有唯一键id）</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> A <span class="keyword">from</span></span><br><span class="line">(<span class="keyword">select</span> *, row_number() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> 分组字段 <span class="keyword">order</span> <span class="keyword">by</span> 排序 <span class="keyword">desc</span>) rn <span class="keyword">from</span> 表名) A</span><br><span class="line"><span class="keyword">where</span> rn = <span class="number">2</span></span><br></pre></td></tr></table></figure><div class="note danger simple"><p>为了避免导致出现重复数据，还是要建议唯一索引比较好</p></div>]]></content>
    
    
    <summary type="html">删除重复记录，删除第一条重复记录</summary>
    
    
    
    <category term="SQL" scheme="http://junonin.github.io/categories/SQL/"/>
    
    
    <category term="SQL" scheme="http://junonin.github.io/tags/SQL/"/>
    
  </entry>
  
  <entry>
    <title>Typora图床</title>
    <link href="http://junonin.github.io/posts/d67c4ae5.html"/>
    <id>http://junonin.github.io/posts/d67c4ae5.html</id>
    <published>2020-09-27T16:00:00.000Z</published>
    <updated>2020-11-27T02:29:29.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="文章说明"><a href="#文章说明" class="headerlink" title="文章说明"></a>文章说明</h2><blockquote><p>Typora的图床设置</p></blockquote><h2 id="Github"><a href="#Github" class="headerlink" title="Github"></a>Github</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"> <span class="attr">&quot;picBed&quot;</span>: &#123;</span><br><span class="line">  <span class="attr">&quot;github&quot;</span>: &#123;</span><br><span class="line">   <span class="attr">&quot;repo&quot;</span>: <span class="string">&quot;Junonin/CloudImg&quot;</span>,</span><br><span class="line">   <span class="attr">&quot;token&quot;</span>: <span class="string">&quot;94ca52b56a70c00e03a80e2f215ea2ae1c4a9125&quot;</span>,</span><br><span class="line">   <span class="attr">&quot;path&quot;</span>: <span class="string">&quot;img/&quot;</span>,</span><br><span class="line">   <span class="attr">&quot;customUrl&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">   <span class="attr">&quot;branch&quot;</span>: <span class="string">&quot;master&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;current&quot;</span>: <span class="string">&quot;github&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;uploader&quot;</span>: <span class="string">&quot;github&quot;</span></span><br><span class="line"> &#125;,</span><br><span class="line"> <span class="attr">&quot;picgoPlugins&quot;</span>: &#123;</span><br><span class="line">  <span class="attr">&quot;picgo-plugin-smms-user&quot;</span>: <span class="literal">true</span></span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="七牛云"><a href="#七牛云" class="headerlink" title="七牛云"></a>七牛云</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;picBed&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;uploader&quot;</span>: <span class="string">&quot;qiniu&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;qiniu&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;accessKey&quot;</span>: <span class="string">&quot;p8ND0-TzhfLmILsCGOnjpdtRtv8m327vaf183Egi&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;secretKey&quot;</span>: <span class="string">&quot;lA-4ecs6_4mTheA4I-Rdyc_Ul1SW5RuAYDD14CzH&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;bucket&quot;</span>: <span class="string">&quot;junonin&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;url&quot;</span>: <span class="string">&quot;http://junonin.clouddn.com&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;area&quot;</span>: <span class="string">&quot;na0&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;options&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;path&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;picgoPlugins&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;picgo-plugin-smms-user&quot;</span>: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="SM-MS"><a href="#SM-MS" class="headerlink" title="SM.MS"></a>SM.MS</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;picBed&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;uploader&quot;</span>: <span class="string">&quot;smms&quot;</span>, <span class="comment">// 代表当前的默认上传图床为 SM.MS,</span></span><br><span class="line">    <span class="attr">&quot;smms&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;token&quot;</span>: <span class="string">&quot;gFkSK6fWws1RfCZ3VYzIDZKwmxcNy1ty&quot;</span> <span class="comment">//XXXX替换为你注册获得的token</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;picgoPlugins&quot;</span>: &#123;&#125; <span class="comment">// 为插件预留</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Typora的图床设置</summary>
    
    
    
    <category term="Tools" scheme="http://junonin.github.io/categories/Tools/"/>
    
    
    <category term="Typora" scheme="http://junonin.github.io/tags/Typora/"/>
    
  </entry>
  
  <entry>
    <title>WinSCP同步脚本</title>
    <link href="http://junonin.github.io/posts/e9a5b8d2.html"/>
    <id>http://junonin.github.io/posts/e9a5b8d2.html</id>
    <published>2020-08-28T16:00:00.000Z</published>
    <updated>2020-11-25T10:03:48.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="文章说明"><a href="#文章说明" class="headerlink" title="文章说明"></a>文章说明</h2><blockquote><p>为了方便同步不在同一局域网内的机器，使用定时器执行以下脚本(需要安装winscp)，定时同步文件</p></blockquote><h2 id="bat脚本"><a href="#bat脚本" class="headerlink" title="bat脚本"></a>bat脚本</h2><p>创建xxx.bat脚本调用run.txt</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@echo on</span><br><span class="line">rem echo是off 不打印注释rem</span><br><span class="line">title  同步文件</span><br><span class="line">::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span><br><span class="line">::     同步文件</span><br><span class="line">::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span><br><span class="line">cd &quot;C:\Program Files (x86)\WinSCP\&quot;</span><br><span class="line">::以命令行方式同步数据     </span><br><span class="line">set data=%date:~0,4%%date:~5,2%%date:~8,2%</span><br><span class="line">&quot;C:\Program Files (x86)\WinSCP\WinSCP.exe&quot; /console /script=C:\Users\JUNO\Desktop\run.txt /log=C:\log\%data%-log.txt</span><br><span class="line"></span><br><span class="line">pause</span><br></pre></td></tr></table></figure><h2 id="run-txt"><a href="#run-txt" class="headerlink" title="run.txt"></a>run.txt</h2><p>ftp使用的run.txt</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"># winscp.exe /console /script=sample.txt </span><br><span class="line"></span><br><span class="line"># Automatically answer all prompts negatively not to stall</span><br><span class="line"></span><br><span class="line"># the script on errors</span><br><span class="line"></span><br><span class="line"># option echo  on|off </span><br><span class="line"></span><br><span class="line">option echo off</span><br><span class="line"></span><br><span class="line"># option batch on|off|abort|continue</span><br><span class="line"></span><br><span class="line">option batch on</span><br><span class="line"></span><br><span class="line"># option confirm  on|off </span><br><span class="line"></span><br><span class="line">#无需确认直接操作</span><br><span class="line">option confirm off</span><br><span class="line"></span><br><span class="line"># option transfer  binary|ascii|automatic </span><br><span class="line"></span><br><span class="line">#服务端如果没有该文件，则将本地文件删除</span><br><span class="line"></span><br><span class="line"># option synchdelete  on|off</span><br><span class="line"></span><br><span class="line"># option exclude clear | <span class="tag">&lt;<span class="name">mask</span>&gt;</span>[;<span class="tag">&lt;<span class="name">mask2</span>&gt;</span>...]</span><br><span class="line"></span><br><span class="line"># option include clear | <span class="tag">&lt;<span class="name">mask</span>&gt;</span>[;<span class="tag">&lt;<span class="name">mask2</span>&gt;</span>...]</span><br><span class="line"></span><br><span class="line">option synchdelete off</span><br><span class="line"></span><br><span class="line"># open [ sftp|ftp|scp:// ][  [ :password ] @ ] <span class="tag">&lt;<span class="name">host</span>&gt;</span> [ :<span class="tag">&lt;<span class="name">port</span>&gt;</span> ]</span><br><span class="line"></span><br><span class="line"># open user:password@example.com</span><br><span class="line"></span><br><span class="line"># Connect   FTP地址</span><br><span class="line"></span><br><span class="line">open ftp://yd-video:ABCabc123@183.236.23.5:33035</span><br><span class="line"></span><br><span class="line"># Change remote directory</span><br><span class="line"></span><br><span class="line"># 如果同步到远程FTP时,可用此命令转到远程某个目录下</span><br><span class="line"></span><br><span class="line">cd /backup/   </span><br><span class="line"></span><br><span class="line"># Change local directory</span><br><span class="line"></span><br><span class="line"># set to Self&#x27;s working dir  设置需要同步到远程FTP的本地文件目录</span><br><span class="line"></span><br><span class="line">lcd C:\Users\JUNO\Desktop\Learn</span><br><span class="line"></span><br><span class="line"># Force binary mode transfer</span><br><span class="line"></span><br><span class="line"># 使用二进制格式传送 </span><br><span class="line"></span><br><span class="line">option transfer binary</span><br><span class="line"></span><br><span class="line"># Download file to the local directory d:\</span><br><span class="line"></span><br><span class="line"># 拉取文件到本地</span><br><span class="line"></span><br><span class="line"># get examplefile.txt d:\</span><br><span class="line"></span><br><span class="line"># synchronize local|remote|both [ <span class="tag">&lt;<span class="name">local</span> <span class="attr">directory</span>&gt;</span> [ <span class="tag">&lt;<span class="name">remote</span> <span class="attr">directory</span>&gt;</span> ] ]  </span><br><span class="line"></span><br><span class="line"># 从远程同步到本地用Local;从本地同步到远程用Remote</span><br><span class="line"></span><br><span class="line">synchronize remote  </span><br><span class="line"></span><br><span class="line"># Disconnect</span><br><span class="line"></span><br><span class="line">close</span><br><span class="line"></span><br><span class="line"># Exit WinSCP</span><br><span class="line"></span><br><span class="line">exit</span><br></pre></td></tr></table></figure><div class="note red icon simple"><i class="note-icon fas fa-fan"></i><p>附录：<a href="https://juno.lanzous.com/iRuxpirht9a">Demo下载</a></p></div>]]></content>
    
    
    <summary type="html">winscp,ftp同步</summary>
    
    
    
    <category term="Tools" scheme="http://junonin.github.io/categories/Tools/"/>
    
    
    <category term="WinSCP" scheme="http://junonin.github.io/tags/WinSCP/"/>
    
  </entry>
  
  <entry>
    <title>MongoDB</title>
    <link href="http://junonin.github.io/posts/8ead567e.html"/>
    <id>http://junonin.github.io/posts/8ead567e.html</id>
    <published>2020-08-26T16:00:00.000Z</published>
    <updated>2020-11-24T07:08:09.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote><p>MongoDB学习记录</p></blockquote><h2 id="Docker环境"><a href="#Docker环境" class="headerlink" title="Docker环境"></a>Docker环境</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">进入docker里的mongodb操作界面</span></span><br><span class="line">docker exec -it mongo mongo admin</span><br><span class="line"><span class="meta">#</span><span class="bash">设置管理员账户</span></span><br><span class="line">db.createUser(&#123; user: &#x27;JUNO&#x27;, pwd: &#x27;123456&#x27;, </span><br><span class="line">roles: [ &#123; role: &quot;userAdminAnyDatabase&quot;, db: &quot;admin&quot; &#125; ] &#125;);</span><br><span class="line"><span class="meta">#</span><span class="bash">授权登录</span></span><br><span class="line">数据库内部</span><br><span class="line">db.auth(&quot;JUNO&quot;,&quot;123456&quot;);</span><br><span class="line">外部shell</span><br><span class="line">mongo --authenticationDatabase  -u  -p</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">修改密码</span></span><br><span class="line">db.updateUser(</span><br><span class="line">   &quot;root&quot;,</span><br><span class="line">   &#123;</span><br><span class="line">      pwd: &quot;abc&quot;</span><br><span class="line">   &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="MongoDB数据库"><a href="#MongoDB数据库" class="headerlink" title="MongoDB数据库"></a>MongoDB数据库</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">#查看所有数据库</span><br><span class="line">#要数据库有数据才显示数据库</span><br><span class="line">show dbs</span><br><span class="line"></span><br><span class="line">#查看所有用户</span><br><span class="line">show users</span><br><span class="line"></span><br><span class="line">#如果数据库不存在，则创建数据库，否则切换到指定数据库。</span><br><span class="line">use DATABASE_NAME</span><br><span class="line"></span><br><span class="line">db.dropDatabase(&quot;DATABASE_NAME&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#创建和删除用户都要在对应的数据库下</span><br><span class="line">use test;</span><br><span class="line">db.dropUser(&quot;test&quot;);</span><br><span class="line"></span><br><span class="line">#查看已有集合</span><br><span class="line">show collections </span><br><span class="line">show tables</span><br><span class="line"></span><br><span class="line">db.COLLECTION_NAME.drop()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="增加"><a href="#增加" class="headerlink" title="增加"></a>增加</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">增加一条_id不存在的数据</span><br><span class="line">db.COLLECTION_NAME.insert(document)</span><br><span class="line"></span><br><span class="line">如果 _id 主键存在则更新数据，如果不存在就插入数据</span><br><span class="line">db.COLLECTION_NAME.insertOne(document)</span><br><span class="line">db.COLLECTION_NAME.replaceOne(document) </span><br><span class="line"></span><br><span class="line">#定义变量插入</span><br><span class="line">document&#x3D;(&#123;title: &#39;MongoDB 教程&#39;, </span><br><span class="line">    description: &#39;MongoDB 是一个 Nosql 数据库&#39;</span><br><span class="line">&#125;);</span><br><span class="line">db.col.insert(document)</span><br><span class="line"></span><br><span class="line">#插入单条记录</span><br><span class="line">db.collection.insertOne(&#123;&quot;a&quot;: 3&#125;)</span><br><span class="line">#插入多条记录</span><br><span class="line">db.collection.insertMany([&#123;&quot;b&quot;: 3&#125;, &#123;&#39;c&#39;: 4&#125;])</span><br></pre></td></tr></table></figure><h2 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">先查询</span><br><span class="line">db.col.find(&#123;&#39;name&#39;:&#39;xxx&#39;&#125;)</span><br><span class="line">删除</span><br><span class="line">db.col.remove(&#123;&#39;name&#39;:&#39;xxx&#39;&#125;)</span><br><span class="line"></span><br><span class="line">只想删除第一条找到的记录可以设置 justOne 为 1</span><br><span class="line">db.COLLECTION_NAME.remove(DELETION_CRITERIA,1)</span><br></pre></td></tr></table></figure><h2 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">#修改所有匹配的数据</span><br><span class="line">db.col.update(&#123;&#39;title&#39;:&#39;MongoDB 教程&#39;&#125;,&#123;$set:&#123;&#39;title&#39;:&#39;MongoDB&#39;&#125;&#125;)</span><br><span class="line">#只会修改第一条匹配的数据</span><br><span class="line">#需要设置 multi 参数为 true</span><br><span class="line">db.col.update(&#123;&#39;title&#39;:&#39;MongoDB 教程&#39;&#125;,&#123;$set:&#123;&#39;title&#39;:&#39;MongoDB&#39;&#125;&#125;,&#123;multi:true&#125;)</span><br><span class="line"></span><br><span class="line">$inc</span><br><span class="line">对某个字段进行增减操作，若键值不存在便增加</span><br><span class="line">db.col.update(&#123;&quot;uid&quot; : &quot;201203&quot;&#125;,&#123;&quot;$inc&quot;:&#123;&quot;size&quot; : 1&#125;&#125;)</span><br><span class="line"></span><br><span class="line">$set</span><br><span class="line">指定一个键并覆盖更新键值，若键不存在并创建</span><br><span class="line">db.col.update(&#123;&quot;uid&quot; : &quot;20120002&quot;,&quot;type&quot; : &quot;3&quot;&#125;,&#123;&quot;$set&quot;:&#123;&quot;sname&quot;:&quot;ssk&quot;&#125;&#125;)</span><br><span class="line"></span><br><span class="line">$unset</span><br><span class="line">用来删除键</span><br><span class="line">db.col.update(&#123;&#39;aaa&#39;:&#39;1111&#39;&#125;,&#123;&#39;$unset&#39;:&#123;&#39;size&#39;:1&#125;&#125;)</span><br><span class="line">删除&#123;&#39;size&#39;：2&#125;的键值</span><br><span class="line"></span><br><span class="line">$push</span><br><span class="line">数组类型的键添加一个数组元素，不过滤重复的数据。添加时键存在，要求键值类型必须是数组；键不存在，则创建数组类型的键。</span><br><span class="line">db.col.update(&#123;&#39;aaa&#39;:&#39;1111&#39;&#125;,&#123;&#39;$push&#39;:&#123;&#39;name&#39;:&#39;xxx&#39;&#125;&#125;)</span><br><span class="line">&quot;name&quot; : [ &quot;xxx&quot;, &quot;xxx&quot; ]</span><br><span class="line"></span><br><span class="line">$ne&#x2F;$addToSet</span><br><span class="line">给数组类型键值添加一个元素时，避免在数组中产生重复数据，$ne在有些情况是不通行的。</span><br><span class="line">db.col.update(&#123;&#39;aaa&#39;:&#39;1111&#39;&#125;,&#123;&#39;$ne&#39;:&#123;&#39;name&#39;:&#39;xxx&#39;&#125;&#125;)</span><br><span class="line">db.col.update(&#123;&#39;aaa&#39;:&#39;1111&#39;&#125;,&#123;&#39;$ne&#39;:&#123;&#39;addToSet&#39;:&#39;xxx&#39;&#125;&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$pop</span><br><span class="line">删除数据元素</span><br><span class="line">从数组的头部 -1</span><br><span class="line">db.col.update(&#123;&#39;aaa&#39;:&#39;1111&#39;&#125;,&#123;&#39;$pop&#39;:&#123;&#39;name&#39;:-1&#125;&#125;)</span><br><span class="line">从数组的尾部删除 1</span><br><span class="line">db.col.update(&#123;&#39;aaa&#39;:&#39;1111&#39;&#125;,&#123;&#39;$pop&#39;:&#123;&#39;name&#39;:1&#125;&#125;)</span><br><span class="line">从数组的尾部删除 0</span><br><span class="line">db.col.update(&#123;&#39;aaa&#39;:&#39;1111&#39;&#125;,&#123;&#39;$pop&#39;:&#123;&#39;name&#39;:0&#125;&#125;)</span><br><span class="line"></span><br><span class="line">$pull</span><br><span class="line">从数组中删除满足条件的元素</span><br><span class="line">db.col.update(&#123;&#39;aaa&#39;:&#39;1111&#39;&#125;,&#123;&#39;$pull&#39;:&#123;&#39;name&#39;:&#39;xxx&#39;&#125;&#125;)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">#等于&#39;name&#39;:&#39;xxx&#39;</span><br><span class="line">db.col.find(&#123;&#39;name&#39;:&#39;xxx&#39;&#125;)</span><br><span class="line"></span><br><span class="line">#大于&gt;$gt（greater  than ）</span><br><span class="line">db.col.find(&#123;&#39;name&#39;:&#123;$gt:20&#125;&#125;)</span><br><span class="line"></span><br><span class="line">#小于&lt;$lt (less  than )</span><br><span class="line">db.col.find(&#123;&#39;name&#39;:&#123;$lt:20&#125;&#125;)</span><br><span class="line"></span><br><span class="line">#大于等于  &gt;&#x3D;$gte(greater  than or   equal to)</span><br><span class="line">db.col.find(&#123;&#39;name&#39;:&#123;$gte:20&#125;&#125;)</span><br><span class="line"></span><br><span class="line">#小于等于  &lt;&#x3D;$lte(less than  or equal to )</span><br><span class="line">db.col.find(&#123;&#39;name&#39;:&#123;$lte:20&#125;&#125;)</span><br><span class="line"></span><br><span class="line">#不等于</span><br><span class="line">$ne  !&#x3D; （not equal to）  &#123;&#39;age&#39;: &#123;&#39;$ne&#39;: 20&#125;&#125;</span><br><span class="line"></span><br><span class="line">#在范围内</span><br><span class="line">$in    &#123;&#39;age&#39;: &#123;&#39;$in&#39;: [20, 23]&#125;&#125;   注意用list</span><br><span class="line"></span><br><span class="line">#不在范围内</span><br><span class="line">$nin  (not in) &#123;&#39;age&#39;: &#123;&#39;$nin&#39;: [20, 23]&#125;&#125; </span><br><span class="line">这个方法可以计算某个值既不等于x也不等于y</span><br><span class="line"></span><br><span class="line">匹配以M开头的名字</span><br><span class="line">$regex (正则匹配） db.collection.find(&#123;&#39;name&#39;: &#123;&#39;$regex&#39;: &#39;^M.*&#39;&#125;&#125;)  </span><br><span class="line">        </span><br><span class="line">查找name属性存在</span><br><span class="line">$exists   属性是否存在  &#123;&#39;name&#39;: &#123;&#39;$exists&#39;: True&#125;&#125;     </span><br><span class="line">        </span><br><span class="line">#类型判断</span><br><span class="line">$type     类型判断        &#123;&#39;age&#39;: &#123;&#39;$type&#39;: &#39;int&#39;&#125;&#125;    age的类型为int</span><br><span class="line"></span><br><span class="line">#text类型的属性中包含Mike字符串</span><br><span class="line">$text      文本查询      &#123;&#39;$text&#39;: &#123;&#39;$search&#39;: &#39;Mike&#39;&#125;&#125;     </span><br><span class="line"></span><br><span class="line">#查找多种条件</span><br><span class="line">$or  查找多种条件   (&#123;&#39;$or&#39;:[&#123;&#39;name&#39;:&#39;chen&#39;&#125;,&#123;&#39;name&#39;:&#39;wang&#39;&#125;]&#125;)</span><br></pre></td></tr></table></figure><h2 id="MongoDB权限"><a href="#MongoDB权限" class="headerlink" title="MongoDB权限"></a>MongoDB权限</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#创建用户</span><br><span class="line">db.createUser(</span><br><span class="line">  &#123;</span><br><span class="line">    user: &quot;admin&quot;,</span><br><span class="line">    pwd: &quot;123456&quot;,</span><br><span class="line">    roles: [</span><br><span class="line">       &#123; role: &quot;userAdminAnyDatabase&quot;, db: &quot;admin&quot; &#125;,</span><br><span class="line">       &#123; role: &quot;dbOwner&quot;, db: &quot;Test&quot; &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">#更改用户权限</span><br><span class="line">db.updateUser(&#39;admin&#39;,&#123;roles:[&#123;role:&#39;userAdminAnyDatabase&#39;,db:&#39;admin&#39;&#125;]&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">db.updateUser( &quot;abc&quot;,</span><br><span class="line">&#123;</span><br><span class="line">roles:[</span><br><span class="line">         &#123; role : &quot;readWrite&quot;, db : &quot;abc&quot;  &#125;,</span><br><span class="line">     &#123;role:&quot;read&quot;, db:&quot;testDB&quot;&#125;</span><br><span class="line">    </span><br><span class="line">      ]</span><br><span class="line">&#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#增加权限</span><br><span class="line">db.grantRolesToUser( &quot;&lt;username&gt;&quot;, [ &lt;roles&gt; ], &#123; &lt;writeConcern&gt; &#125; )</span><br><span class="line"></span><br><span class="line">#回收权限</span><br><span class="line">db.revokeRolesFromUser( &quot;&lt;username&gt;&quot;, [ &lt;roles&gt; ], &#123; &lt;writeConcern&gt; &#125;)</span><br><span class="line"></span><br><span class="line">--db.grantRolesToUser(&quot;usertest&quot;, [&#123;role:&quot;read&quot;, db:&quot;testDB&quot;&#125;])</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="角色权限"><a href="#角色权限" class="headerlink" title="角色权限"></a>角色权限</h2><h4 id="数据库用户角色（Database-User-Roles）："><a href="#数据库用户角色（Database-User-Roles）：" class="headerlink" title="数据库用户角色（Database User Roles）："></a>数据库用户角色（Database User Roles）：</h4><ul><li> read：授予User只读数据的权限</li><li> readWrite：授予User读写数据的权限</li></ul><h4 id="数据库管理角色（Database-Administration-Roles）："><a href="#数据库管理角色（Database-Administration-Roles）：" class="headerlink" title="数据库管理角色（Database Administration Roles）："></a>数据库管理角色（Database Administration Roles）：</h4><ul><li> dbAdmin：在当前dB中执行管理操作</li><li> <strong>dbOwner：在当前DB中执行任意操作</strong></li><li> userAdmin：在当前DB中管理User</li></ul><h4 id="备份和还原角色（Backup-and-Restoration-Roles）："><a href="#备份和还原角色（Backup-and-Restoration-Roles）：" class="headerlink" title="备份和还原角色（Backup and Restoration Roles）："></a>备份和还原角色（Backup and Restoration Roles）：</h4><ul><li> backup</li><li>restore</li></ul><h4 id="跨库角色（All-Database-Roles）："><a href="#跨库角色（All-Database-Roles）：" class="headerlink" title="跨库角色（All-Database Roles）："></a>跨库角色（All-Database Roles）：</h4><ul><li> readAnyDatabase：授予在所有数据库上读取数据的权限</li><li> readWriteAnyDatabase：授予在所有数据库上读写数据的权限</li><li> userAdminAnyDatabase：授予在所有数据库上管理User的权限</li><li> dbAdminAnyDatabase：授予管理所有数据库的权限</li></ul><h4 id="集群管理角色（Cluster-Administration-Roles）："><a href="#集群管理角色（Cluster-Administration-Roles）：" class="headerlink" title="集群管理角色（Cluster Administration Roles）："></a>集群管理角色（Cluster Administration Roles）：</h4><ul><li> clusterAdmin：授予管理集群的最高权限</li><li> clusterManager：授予管理和监控集群的权限</li><li> clusterMonitor：授予监控集群的权限，对监控工具具有readonly的权限</li><li> hostManager：管理Server</li></ul>]]></content>
    
    
    <summary type="html">MongoDB学习记录</summary>
    
    
    
    <category term="SQL" scheme="http://junonin.github.io/categories/SQL/"/>
    
    
    <category term="MongoDB" scheme="http://junonin.github.io/tags/MongoDB/"/>
    
  </entry>
  
</feed>
